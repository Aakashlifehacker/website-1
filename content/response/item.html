
<style>
  .panels {
    margin:20px 0px 20px 0px;
    min-height:300px;
  }
</style>

<div class="container-fluid">
  <div class="row">
    <div class="col-md-12">

      <div id="missing" style="display:none;">
        <div class="jumbotron">
          <p>Sorry, we have no record of expecting to receive any items for that ID. If you think there should be, please <a href="mailto:requests@openaccessbutton.org">get in touch</a>.</p>
        </div>
      </div>

      <div id="request" style="display:none;">
      </div>

      <div class="panels" id="upload" style="margin-bottom:100px;">
        <p>
          Thank you for responding to our request! All we need is a URL to a web page where the requested content
          can be publicly accessed without restriction. It's best if the URL for an article goes directly to the full text.
        </p>

        <p>
          If you don't have it online anywhere yet, then upload a file
          and we'll publish it for you! If you have more than one file, or a folder of files, please zip them first.
        </p>

        <p id="typearticle">
          We will send your article to <a href="https://zenodo.org/"></a>Zenodo</a> for safe keeping. Here it will be hosted, preserved, and identified.
        </p>

        <p id="typedata">
          We will send your data to the <a href="https://osf.io">Open Science Framework</a>.
          The Open Science Framework will host, preserve, and identify your data. We’ll use the paper title and abstract to provide initial metadata and licence the data CC-0 (the recommended licence for sharing data). You’ll be able to change this information later if you wish.
          <br>Once you submit the data, we'll send it to the requestor. When they've checked it's what they need you'll receive an Open Data Badge.
        </p>

        <input style="margin-top:50px;" id="url" type="text" class="form-control" placeholder="Enter your URL here, OR:">
        <input type="file" id="file" class="form-control" style="margin-top:5px;">
        <textarea id="description" class="form-control" style="min-height:120px;margin-top:5px;" placeholder="Please provide a brief description or further information here, if necessary"></textarea>
        <a href="#" class="btn btn-action btn-block" style="margin-top:5px;" id="submit">Submit</a>
      </div>

      <div class="panels" id="submitted">
        <div class="jumbotron">
          <p>
            Thank you for submitting your content!<br>
            We will inform our community that you have provided this,
            and it will be validated to ensure it is what is needed.
          </p>
        </div>
      </div>

      <div class="panels" id="validating">
        <div class="jumbotron">
          <p>
            This content has already been received, and is currently awaiting validation from the requestor.<br>
            Please view the original request (above) for further information.
          </p>
        </div>
      </div>

      <div class="panels" id="validated">
        <div class="jumbotron">
          <p>
            This content has already been received and validated.<br>
            There is no further action to take.<br>
            Please view the original request (above) for further information.
          </p>
        </div>
      </div>

      <div class="panels" id="hold">
        <div class="jumbotron">
          <p>
            Thank you for your response.<br>
            We will put this request on hold for <span id="holdlength">X</span> days.
          </p>
        </div>
      </div>

      <div class="panels" id="refuse">
        <div class="jumbotron">
          <p>
            Thank you for your response.<br>
            We are sorry to hear that you are unable to provide the content.<br>
            We will let resquestors know it cannot be made available, and display that publically on the request page.
          </p>
        </div>
      </div>

    </div>
  </div>
</div>






<script>
  jQuery(document).ready(function() {
    var api = 'https://api.openaccessbutton.org';
    if (window.location.host.indexOf('openaccessbutton.org') === -1) {
      api = 'https://dev.api.cottagelabs.com/service/oab';
    }

    //$('.panels').hide();
    var request;
    var rid = window.location.pathname.split('/')[2];

    var submit = function(e) {
      e.preventDefault();

      // old code that did receiving
      /*
        Template.oabuttonupload.helpers({
          oabuploadactions: function() {
            return {
              formData: function() { return { service: 'openaccessbutton', dirId: Session.get("respid") } },
              finished: function(index, fileInfo, context) {
                Session.set("uploadcount",Session.get("uploadcount")+1);
              }
            }
          }
        });
        setreceived: function(respid,description,url) {
          var req = OAB_Request.findOne({receiver:respid});
          if (req && req.received === undefined) CLapi.internals.service.oabutton.receive(respid,undefined,url,description);
        },

      */
      alert('TODO should submit the file/URL now');
    }
    $('#submit').bind('click',submit);

    var details = function(data) {
      request = data;
      var dets = '<div class="jumbotron" style="margin-top:-10px;">';
      dets += '<h3 style="text-align:center;">Request for ' + request.type + '</h3>';
      dets += '<h2 style="text-align:center;"><a style="color:white;" target="_blank" href="/request/' + request._id + '">';
      dets += request.title ? request.title : 'Untitled article';
      dets += '</a></h2>';
      dets += '</div>';
      $('#request').html(dets).show();
      $('#type' + request.type).show();

      if (request.status === 'received') {
        request.received.validated === false ? $('#validating').show() : $('#validated').show();
      } else if (window.location.href.indexOf('hold=') !== -1) {
        var hold = parseInt(window.location.href.split('hold=')[1].split('&')[0].replace('day','').replace('s',''));
        $.ajax({type: 'GET',url: api + '/receive/' + rid + '/'+hold});
        $('#holdlength').html(hold);
        $('#hold').show();
      } else if (window.location.href.indexOf('refuse=') !== -1) {
        $.ajax({type: 'GET',url: api + '/receive/' + rid + '/refuse'});
        $('#refuse').show();
      } else {
        $('#upload').show();
      }
    }
    $.ajax({
      type: 'GET',
      url: api + '/receive/' + rid,
      success: details,
      error: function() { $('.panels').hide(); $('#missing').show(); }
    });

  });
</script>
