<head>
  <title>InstantILL</title>
</head>
<link rel="stylesheet" href="/static/oabutton_rebrand.css"> <!-- gets the new css (still also uses the old css, just overwrites where necessary) -->

<style>
  #topnav {
    display: none;
  }
  #footer {
    display: none;
  }

  .form-control {
    color:#46b633;
    border:2px solid #46b633;
  }

  a {
    color:#46b633;
    font-weight:normal;
  }
  a:hover {
    color:#46b633;
  }

  .btn-hollow-green:hover {
    color: #edf8ed;
  }

  p{
    padding:0;
    margin: 10px 0;
  }

  h2{
    text-align: left;
  }

  .alert-new {
    width: 100%;
    padding: 10px;
    background-color: #46b633;
    color: white;
    text-align: center !important;
  }

</style>


<div class="alert-new">
  <div class="center-col">
    <div>
      <p style="text-align:center;">
        InstantILL is currently in Beta. Please <a href="https://docs.google.com/forms/d/e/1FAIpQLSfuOt79zFU9w4vWKhTJua7pjFnQotT_fq__3sA37sNOUsKhdg/viewform?usp=sf_link" class="green" style="color:white"><b>let us know</b></a> how setup goes.
      </p>
    </div>
  </div>
</div>


<div id="demo" class="container-fluid">

  <div id="menu" class="section">
    <div class="row">
      <div class="col-md-6 col-md-offset-1 content">
        <div id="instantill"></div>
      </div>

      <div class="col-md-4 col-md-offset-1 green">
        <div class="greenery">
          <h2>Let’s get you set up!</h2>

          <p>
            Congrats, you already have InstantILL partly set up! It finds Open Access articles and submit loans to your email. As you complete the steps below you’ll be able to customize further. It requires no coding or systems expertise, on <a href="#compatibility" class="view green">compatibile systems</a> and doesn’t take long.
          </p>
          <p>
            At anytime you can test InstantILL, with your settings, on the left. It’ll work just like it would on your pages, although it won’t be styled to fit with your brand yet.
          </p>
          <p><b>
            Get InstantILL working with your:
          </b></p>

          <ul class="arrowed">
            <li>
              <a class="green view pull preview" val="10.1145/2908080.2908114" href="#ill">
                <span class="glyphicon glyphicon-arrow-right">
              </span> Interlibrary loans</a>
            </li>
            <li>
              <a class="green view pull preview" val="10.1145/2908080.2908114" href="#subscription"><span class="glyphicon glyphicon-arrow-right">
              </span> Subscriptions</a>
            </li>
            <li>
              <a class="green view pull preview" val="10.1145/2908080.2908114" href="#embed">
                <span class="glyphicon glyphicon-arrow-right">
              </span> Website &amp; Brand</a>
            </li>
            <li>
              <a class="green view pull preview" val="10.1145/2908080.2908114" href="#workflow">
                <span class="glyphicon glyphicon-arrow-right">
              </span> Discovery tools</a>
            </li>
          </ul>

            <p><b>Once set up, it's time to:</b></p>

            <ul class="arrowed">
              <li>
                <a class="green view pull restart" href="#rollout">
                <span class="glyphicon glyphicon-arrow-right"></span> Rollout</a>
              </li>
              <li>
                <a class="green" href="https://instantill.org/leadership">
                <span class="glyphicon glyphicon-arrow-right"></span> Support InstantILL</a>
              </li>
              <li>
                <a class="green view pull preview" val="10.1145/2908080.2908114" href="#analytics">
                <span class="glyphicon glyphicon-arrow-right"></span> View Analytics</a>
              </li>
            </ul>
            <p>For more, check the
              <a class="green view pull preview" val="10.1145/2908080.2908114" href="#advanced">advanced settings</a>.
            </p>

        </div>

        <div class="greenbottom">
          <p><a class="btn btn-demo-green  save view pull" href="#ill">Get Started</a></p>
          <p><a class="green" href="/feedback#general">Feedback</a> | <a class="green view" href="#faq">FAQ</a> | <a class="green" href="/feedback#bug"> Report Issue</a></p>
        </div>
      </div>
    </div>
  </div>

  <div id="ill" class="section">
    <div class="row">
      <div class="col-md-6 col-md-offset-1 content">

      </div>

      <div class="col-md-4 col-md-offset-1 green">
        <div class="greenery">
          <p><a class="green view pull" href="#menu"><span class="glyphicon glyphicon-arrow-left"></span>  Go to Menu</a></p>
          <h2>Interlibrary loans: Submission (1/3)</h2>
          <p>
            InstantILL uses your existing Interlibrary Loan systems to manage authentication, fulfillment, and payment, or can submit to an email address.
          </p>

          <p><b>What is your ILL article form link?</b></p>
          <input id="ill_redirect_base_url" type="text" class="form-control setting green" placeholder="URL">
          <p>
          Or <a href="#ill-email" class="view green">submit over email</a>
          </p>
          <br>
          <p>
            If everything works, hit next! If it doesn’t, <a href="#ill-advanced" class="view green pull">see advanced settings</a>.
          </p>

        </div>

        <div class="greenbottom">
          <p><a class="btn btn-hollow-green save pull preview" href="#">Preview & Test</a></p>
          <p><a class="btn btn-demo-green save view pull reset" href="#ill-input">Save & Continue</a></p>
          <p><a class="green" href="/feedback#general">Feedback</a> | <a class="green view" href="#faq">FAQ</a> | <a class="green" href="/feedback#bug"> Report Issue</a></p>
        </div>
      </div>
    </div>
  </div>

  <div id="ill-input" class="section">
    <div class="row">
      <div class="col-md-6 col-md-offset-1 content">

      </div>

      <div class="col-md-4 col-md-offset-1 green">
        <div class="greenery">
          <p><a class="green view" href="#ill"><span class="glyphicon glyphicon-arrow-left"></span>  Go back</a></p>
          <h2>Interlibrary loan: Input (2/3)</h2>
          <p>
            Now that you can submit article requests, you can adjust some key details about loans. Everything is optional, and we’ve set common defaults. In this section, we'll adjust what users see before they submit.
          </p>

          <p><b>What is the name of your institution?</b></p>
          <input id="ill_institution" type="text" class="form-control setting green" placeholder="Institution name">
          <br>

          <p><b>What email address do you want users referred to if there is a problem?</b></p>
          <input id="problem_email" type="text" class="form-control setting green" placeholder="User will be told to 'contact their library'">
          <br>

          <p><b>
            We use 'article' to refer to academic journal publications by default. Would you like to change that?
          </b></p>
          <p>
          <input id="saypaper" type="checkbox" class="setting green">
            Yes, use 'paper' instead.
          </p>
          <br>

          <p><b>Where do you want people sent if they want a book?</b></p>
          <input id="book" type="text" class="form-control setting green" placeholder="e.g https://ill.ulib.iupui.edu/ILLiad/IUP/illiad.dll?Action=10&Form=21">
          <br>

          <p><b>Where do you want people sent if they want something other than a book or article?</b></p>
          <input id="other" type="text" class="form-control setting green" placeholder="e.g https://ill.ulib.iupui.edu/ILLiad/IUP/illiad.dll?Action=10&Form=10">
          <br>

          <p><b>If you want patrons want to learn details about Interlibrary Loan services, where can they find that?</b></p>
          <small>This helps keep the page you embed InstantILL on clean and tidy while still making sure interested patrons can learn about ILL</small>
          <input id="illinfo" type="text" class="form-control setting green" placeholder="e.g https://ulib.iupui.edu/services/ILL">
          <br>

          <p><b>If you want to allow users to view their account and outstanding loans, let us know where they can do that. </b></p>
          <small>This helps keep the page you embed InstantILL on clean and tidy while allowing users to manage their accounts.</small>
          <input id="viewaccount" type="text" class="form-control setting green" placeholder="e.g https://ill.ulib.iupui.edu/ILLiad/IUP/illiad.dll?Action=10&Form=62">
          <br>

          <p><b>If you want people to still be able to submit ILLs manually, let us know how they can do that.</b></p>
          <small>This helps make sure people who liked the old way of doing things still can</small>
          <input id="advancedform" type="text" class="form-control setting green" placeholder="e.g https://ill.ulib.iupui.edu/ILLiad/IUP/illiad.dll?Action=10&Form=10">
          <br>

        </div>

        <div class="greenbottom">
          <p><a class="btn btn-hollow-green  save pull preview" href="#">Preview & Test</a></p>
          <p><a class="btn btn-demo-green  save view pull preview" href="#ill-results">Save & Continue</a></p>
          <p><a class="green" href="/feedback#general">Feedback</a> | <a class="green view" href="#faq">FAQ</a> | <a class="green" href="/feedback#bug"> Report Issue</a></p>
        </div>
      </div>
    </div>
  </div>

    <div id="ill-results" class="section">
      <div class="row">
        <div class="col-md-6 col-md-offset-1 content">

        </div>

        <div class="col-md-4 col-md-offset-1 green">
          <div class="greenery">
            <p><a class="green view" href="#ill"><span class="glyphicon glyphicon-arrow-left"></span>  Go back</a></p>
            <h2>Interlibrary loan: Results (3/3)</h2>
            <p>
              Now that you can submit article requests, you can adjust some key details about loans. Everything is optional, and we’ve set common defaults. In this section, we'll adjust what patrons see for results.
            </p>

            <p><b>What do your article ILLs cost?</b></p>
            <small>Please include your currency symbol e.g $4</small>
            <input id="cost" type="text" class="form-control setting green" placeholder="default free">
            <br>

            <p><b>How long do your article ILLs take to deliver on average?</b></p>
            <small>Please include the unit e.g 24 hours</small>
            <input id="time" type="text" class="form-control setting green" placeholder="default 24 hours">
            <br>

            <p><b>
              If we find an article Open Access, do you want to let patrons request an ILL?
            </b></p>
            <p>
            <input id="noillifoa" type="checkbox" class="setting green">
              No
            </p>
            <br>

            <p><b>
              If we find that you're subscribed to an article, do you still want patrons to be able to request an ILL?
            </b></p>
            <p>
            <input id="noillifsub" type="checkbox" class="setting green">
              No
            </p>
            <br>

          </div>

          <div class="greenbottom">
            <p><a class="btn btn-hollow-green  save pull preview" href="#">Preview & Test</a></p>
            <p><a class="btn btn-demo-green  save view pull" href="#subscription">Save & Continue</a></p>
            <p><a class="green" href="/feedback#general">Feedback</a> | <a class="green view" href="#faq">FAQ</a> | <a class="green" href="/feedback#bug"> Report Issue</a></p>
          </div>
        </div>
      </div>
    </div>


  <div id="ill-advanced" class="section">
    <div class="row">
      <div class="col-md-6 col-md-offset-1 content">

      </div>

      <div class="col-md-4 col-md-offset-1 green">
        <div class="greenery">
          <p><a class="green view" href="#ill"><span class="glyphicon glyphicon-arrow-left"></span>  Go back</a></p>
          <h2>Interlibrary loan: Advanced</h2>
          <p>
            InstantILL uses your existing Interlibrary Loan systems to manage authentication, fulfillment, and payment, or can submit to an email address.
          </p>

          Add any additional params your base URL needs, such as a=b&c=d<br>
          <input id="ill_redirect_params" type="text" class="form-control setting green" placeholder="Add any additional params your base URL needs"><br>
          <!--<input id="method" type="text" class="form-control setting" placeholder="default GET"><br>-->
          Add the param used to provide a service ID (which will be InstantILL)<br>
          <input id="sid" type="text" class="form-control setting green" placeholder="default sid">
          <br>
          Title<br>
          <input id="title" type="text" class="form-control setting green" placeholder="default atitle">
          <br>
          Journal title<br>
          <input id="journal" type="text" class="form-control setting green" placeholder="default title">
          <br>
          DOI<br>
          <input id="doi" type="text" class="form-control setting green" placeholder="default rft_id">
          <br>
          Author<br>
          <input id="author" type="text" class="form-control setting green" placeholder="default au">
          <br>
          ISSN<br>
          <input id="issn" type="text" class="form-control setting green" placeholder="default issn">
          <br>
          Volume<br>
          <input id="volume" type="text" class="form-control setting green" placeholder="default volume">
          <br>
          Issue<br>
          <input id="issue" type="text" class="form-control setting green" placeholder="default issue">
          <br>
          Page<br>
          <input id="page" type="text" class="form-control setting green" placeholder="default pages">
          <br>
          Published<br>
          <input id="published" type="text" class="form-control setting green" placeholder="default date">
          <br>
          PMID<br>
          <input id="pmid" type="text" class="form-control setting green" placeholder="default pmid">
          <br>
          <!--<input id="pmcid" type="text" class="form-control setting" placeholder="default pmcid"><br>-->
          Year
          <input id="year" type="text" class="form-control setting green" placeholder="default rft.year">
          <br>



          </p>
        </div>

        <div class="greenbottom">
          <p><a class="btn btn-hollow-green  save pull preview" href="#">Preview & Test</a></p>
          <p><a class="btn btn-demo-green  save view pull" href="#">Save & Continue</a></p>
          <p><a class="green" href="/feedback#general">Feedback</a> | <a class="green view" href="#faq">FAQ</a> | <a class="green" href="/feedback#bug"> Report Issue</a></p>
        </div>
      </div>
    </div>
  </div>

  <div id="ill-email" class="section">
    <div class="row">
      <div class="col-md-6 col-md-offset-1 content">

      </div>

      <div class="col-md-4 col-md-offset-1 green">
        <div class="greenery">
          <p><a class="green view pull" href="#menu"><span class="glyphicon glyphicon-arrow-left"></span>  Go to Menu</a></p>
          <h2>Interlibrary loans: Submission (1/2)</h2>
          <p>
            InstantILL uses your existing Interlibrary Loan systems to manage authentication, fulfillment, and payment, or can submit to an email address.
          </p>
          <p><b>What email address do you want ILLs sent to? (optional for email alternative)</b></p>
          <input id="email" type="text" class="form-control setting green" placeholder="default is your OAB account email address">
          <br>
          <p><b>
            If you use WMS, inside our notifications we can provide direct links to journals to save you time. Just let us know your WMS URL.
          </b>
          <input id="search" type="text" class="form-control setting green" placeholder="e.g  https://ambslibrary.share.worldcat.org/wms/cmnd/nd/discover/items/search"><br>
          </p>
          <br>
          <p><b>Terms and conditions link</b><p>
          <input id="terms" type="text" class="form-control setting green" placeholder="e.g https://libguides.newman.ac.uk/students/inter_library/terms">
          <br>

        </div>

        <div class="greenbottom">
          <p><a class="btn btn-hollow-green  save pull preview" href="#">Preview & Test</a></p>
          <p><a class="btn btn-demo-green  save view pull" href="#ill-input">Save & Continue</a></p>
          <p><a class="green" href="/feedback#general">Feedback</a> | <a class="green view" href="#faq">FAQ</a> | <a class="green" href="/feedback#bug"> Report Issue</a></p>
        </div>
      </div>
    </div>
  </div>

  <div id="subscription" class="section">
    <div class="row">
      <div class="col-md-6 col-md-offset-1 content">

      </div>

      <div class="col-md-4 col-md-offset-1 green">
        <div class="greenery">
          <p><a class="green view pull" href="#menu"><span class="glyphicon glyphicon-arrow-left"></span>  Go to Menu</a></p>
          <h2>Subscriptions</h2>
          <p>
            We use your link resolver to understand what you do and don’t have access to. Then, we figure out the best link and send your patrons to it through your proxy.
            <p><b>What is your link resolver URL?</b></p>
            <small>Examples include: http://rx8kl6yf4x.search.serialssolutions.com, https://cricksfx.hosted.exlibrisgroup.com<!--, http://resolver.ebscohost.com/openurl-->.</small>

            <input style="margin-top:10px;" type="text" class="form-control subscription setting green" placeholder="e.g http://rx8kl6yf4x.search.serialssolutions.com">
            <select style="margin-top:10px;" class="form-control subscription_type setting green">
              <option value="">select subscription type...</option>
              <option value="sfx">SFX</option>
              <!--<option value="eds">EDS / Ebsco</option>-->
              <option value="serialssolutions">Serials Solutions</option>
            </select>
            <a style="margin-top:10px;" class="btn btn-demo-green" id="addsubscription" href="#">Add another</a>
          </p>

          <p>What is the DOI of an article you definitely have access to, which can be used for testing?</p>
          <p><input id="val" type="text" class="form-control setting green" placeholder="e.g 10.1234/567890"></p>
        </div>
        <div class="greenbottom">
          <p><a class="btn btn-hollow-green  save pull preview" href="#">Preview & Test</a></p>
          <p><a class="btn btn-demo-green  save view pull" href="#embed">Save & Continue</a></p>
          <p><a class="green" href="/feedback#general">Feedback</a> | <a class="green view" href="#faq">FAQ</a> | <a class="green" href="/feedback#bug"> Report Issue</a></p>
        </div>
      </div>
    </div>
  </div>

  <div id="embed" class="section">
    <div class="row">
      <div class="col-md-6 col-md-offset-1 content">

      </div>

      <div class="col-md-4 col-md-offset-1 green">
        <div class="greenery">
          <p><a class="green view pull" href="#menu"><span class="glyphicon glyphicon-arrow-left"></span>  Go to Menu</a></p>
          <h2>Website &amp; Brand</h2>

          <p>
            InstantILL can be integrated onto any webpage on your website, and blend in with your brand.
          </p>
          <p>
            <!--
            To do that you can follow these simple instructions or we’ve drafted an email you can <a href="mailto:" class="light">send your developer</a>.
            -->
            To do that you can follow these simple instructions or send these to your developers.
          </p>

          <p>
            First, include the following in the source code (HTML) of your page:
          </p>
          <pre class="stickidin">
&lt;script src="{{site_url}}/static/instantill.js"&gt;&lt;/script&gt;&lt;script&gt;instantill();&lt;/script&gt;
&lt;div id="instantill"&gt;&lt;/div&gt;</pre>

        <p>You can control where the search widget gets displayed by moving:</p>
          <pre>
&lt;div id="instantill"&gt;&lt;/div&gt;</pre>

        <p>
          If you don’t think it’s styled corrected, a developer can help you. If you have one, great, if not <a href="mailto:joe@openaccessbutton.org" class="light">reach out</a>.
        </p>

        <p>You should now be good to go!</p>

        <h3>We suggest:</h3>
        <ul>
          <li>Calling your page ‘Get a paper’</li>
          <li>Not mentioning 'InstantILL' to patrons</li>
          <li>Not putting anything above InstantILL (except a page title)</li>
        </ul>

        </div>
        <div class="greenbottom">
          <p><a class="btn btn-demo-green  save view pull" href="#workflow">Save & Continue</a></p>
          <p><a class="green" href="/feedback#general">Feedback</a> | <a class="green view" href="#faq">FAQ</a> | <a class="green" href="/feedback#bug"> Report Issue</a></p>
        </div>
      </div>
    </div>
  </div>

  <div id="workflow" class="section">
    <div class="row">
      <div class="col-md-6 col-md-offset-1 content">

      </div>

      <div class="col-md-4 col-md-offset-1 green">
        <div class="greenery">
          <p><a class="green view pull" href="#menu"><span class="glyphicon glyphicon-arrow-left"></span>  Go to Menu</a></p>
          <h2>Discovery tools</h2>
          <p>
            To ensure users never need to re-enter their search across different systems you can link to InstantILL from any library system to integrate it into your existing workflows, say from library search or a link resolver.
          </p>
          <p id="embeddedexample" style="display:none;word-wrap:break-word"></p>
          <p id="noembeddedexampleavailable" style="display:none;">
            Once you've used InstantILL on one of your domains, we'll show you an example link you can use to integrate into other systems.
          </p>
          <p>
            If everything works, hit next! If it doesn’t, <a href="#workflow-advanced" class="view green pull">see advanced settings
          </p>
        </div>
        <div class="greenbottom">
          <p><a class="btn btn-hollow-green save pull preview" href="#">Preview & Test</a></p>
          <p><a class="btn btn-demo-green save view pull restart" href="#rollout"></span>Save & Continue</a></p>
          <p><a class="green" href="/feedback#general">Feedback</a> | <a class="green view" href="#faq">FAQ</a> | <a class="green" href="/feedback#bug"> Report Issue</a></p>
        </div>
      </div>
    </div>
  </div>

  <div id="workflow-advanced" class="section">
    <div class="row">
      <div class="col-md-6 col-md-offset-1 content">

      </div>

      <div class="col-md-4 col-md-offset-1 green">
        <div class="greenery">
          <p><a class="green view pull" href="#menu"><span class="glyphicon glyphicon-arrow-left"></span>  Go to Menu</a></p>
          <h2>Workflow: advanced</h2>
          <p>
            It will run automatically on the embedded page if it sees any of the following parameters in the URL: 'doi','title','url','atitle','rft_id','journal','issn','year','author'.
          </p>
          <p><b>
            If you're only linking to InstantILL in the middle of a workflow, you may not want the instructions to show.
          </b></p>
          <small>The instructions are what appear above InstantILLs search box</small>
          <p>
            <input id="intropara" type="checkbox" class="setting">
            Don't show
          </p>
          <!--
          <p><b>Adjust what triggers InstantILL</b></p>
          <p>
            <input id="autorunparams" type="text" class="form-control setting green" placeholder="defaults as above"><br>
          </p>
          <p>
            If InstantILL isn't running when you might expect, that's likely because you're using a paramater we don't recognise.
          </p>
          <p>
            In the box below, you can help us recognise your paramaters.<!--Enter any that you want to use, separated by a comma. If you want to use a custom parameter to pass to one of our defaults listed above, provide your parameter name followed by an "=" and the default name you want it to match. For example if you wanted to use our default "doi" and "title" but with your own custom journal parameter, you could specify this as doi,title,mycustomparam=journal.-->
            <!-- Joe, why don't we use a list similar to how we do ILLs here? -->
          <!--
          </p>
          -->
          <p><b>
            You can completely turn off this feature too.
          </b></p>
          <p>
            <input id="autorun" type="checkbox" class="setting">
            Turn off
          </p>

        </div>
        <div class="greenbottom">
          <p><a class="btn btn-hollow-green save pull preview" href="#">Preview & Test</a></p>
          <p><a class="btn btn-demo-green save view pull" href="menu">Save & Continue</a></p>
          <p><a class="green" href="/feedback#general">Feedback</a> | <a class="green view" href="#faq">FAQ</a> | <a class="green" href="/feedback#bug"> Report Issue</a></p>
        </div>
      </div>
    </div>
  </div>


<div id="rollout" class="section">
  <div class="row">

    <div class="col-md-6 col-md-offset-1 content">

    </div>

    <div class="col-md-4 col-md-offset-1 green">
      <div class="greenery">
      <p><a class="green view pull" href="#menu"><span class="glyphicon glyphicon-arrow-left"></span>  Go to Menu</a></p>
      <h2>Rollout</h2>
      <p>
        Once you're all set up, and you know it's working, it's time to put InstantILL in patron's hands.
      </p>

      <p><b>
        Have you rolled it out?
      </b></p>
      <small>
        Only click this around when you rollout InstantILL to patrons. This helps us support you best, track your stats, and understand how we're doing.
      </small>
      <p>
      <input id="live" type="checkbox" class="setting green">
        Yes
      </p>

      <p><b>
        Activate pilot mode?
      </b></p>
      <small>
        Pilot mode makes it easy to rollout a pilot. Patrons will know why you're trying something new, be able to give feedback and go back to old way. We'll also track the performance of your pilot, and you can ask us to let you know.
      </small>
      <p>
      <input id="pilot" type="checkbox" class="setting green">
        Yes
      </p>

      <p><b>
        Can others contact you to find out about InstantILL?
      </b></p>
      <a href="https://docs.google.com/forms/d/e/1FAIpQLSdK7CQ8J0lJ2hauS0A-qr3g5uBz9h3WZ6Uvj6vxzz0ut8GVbA/viewform?usp=sf_link" class="green">
        Yes, sign me up!
      </p>

    </div>
    <div class="greenbottom">
      <p><a class="btn btn-hollow-green  save pull preview" href="#">Preview & Test</a></p>
      <p><a class="btn btn-demo-green  save view pull" href="menu">Save & Continue</a></p>
      <p><a class="green" href="/feedback#general">Feedback</a> | <a class="green view" href="#faq">FAQ</a> | <a class="green" href="/feedback#bug"> Report Issue</a></p>
    </div>
  </div>
</div>
</div>

  <div id="analytics" class="section">
    <div class="row">
      <div class="col-md-6 col-md-offset-1 content">

      </div>

      <div class="col-md-4 col-md-offset-1 green">
        <div class="greenery">
          <p><a class="green view pull" href="#menu"><span class="glyphicon glyphicon-arrow-left"></span>  Go to Menu</a></p>
          <h2>Analytics</h2>
          <p>
            If you're on our leadership teir, or in pilot mode, and would like a report, email Joe at <a href="joe@openaccessbutton.org">Joe@openaccessbutton.org</a>.
          </p>
          <p>
            We can provide individualized analytics detailing your use of InstantILL. However, since this is not essential to delivering an excellent service to end users, we only provide this to users who support our work through our 'Leadership Tier'. To find our more, go <a href="https://instantill.org/leadership">here</a>.
          </p>


        </div>
        <div class="greenbottom">
          <p><a class="green" href="/feedback#general">Feedback</a> | <a class="green view" href="#faq">FAQ</a> | <a class="green" href="/feedback#bug"> Report Issue</a></p>
        </div>
      </div>
    </div>
  </div>

  <div id="advanced" class="section">
    <div class="row">
      <div class="col-md-6 col-md-offset-1 content">

      </div>

      <div class="col-md-4 col-md-offset-1 green">
        <div class="greenery">
          <p><a class="green view pull" href="#menu"><span class="glyphicon glyphicon-arrow-left"></span>  Go to Menu</a></p>
          <h2>Advanced</h2>
          <p>
            These aren't needed for normal InstantILL set ups, but you may still be useful.
          </p>

          <h3>API</h3>

          <p>
            You can integrate with InstantILL using APIs. For example, you can reteive all the ILLs made through your embed, or use individual features (e.g OA finding, metadata retreival).
          </p>
          <p>
            Full documentation on how to do this can be found <a href="https://openaccessbutton.org/api" class="green">here</a>.
          </p>

          <h3>Making your ILL form work well with InstantILL</h3>

          <p>
            InstantILL is designed to work with your standard form. However, you can improve the user experience by changing it. We suggest passing as much data in the background (not in user visible fields) and treating the page as a confirmation form. We’d like to provide examples of this in various systems, so if you do this and can share your code please <a href=”mailto:joe@openaccessbutton.org”>send it to us</a>.
          </p>

          <h3>Multiple Accounts</h3>

          <p>
            You can have as many InstantILL accounts as you need. This can be helpful for embedding InstantILL into different places (e.g homepage, link resolver, ILL page) with different settings.
          </p>

          <h3>Emails to Authors</h3>
          <p>
            To lower the cost of Interlibrary Loan, and make more articles freely available to everyone, when ILLs are submitted through InstantILL we reach out to the authors of those articles to ask them to make them Open Access.
          </p>
          <p>
            We do this on your behalf, as we have done for years for users of the Open Access Button. The current text of emails we send can be found <a href="https://docs.google.com/document/d/1Kh7Smw0nchvFnfhaglNkPc6aJoJV1j0sooKY-enMhhE/edit?usp=sharing" class="green">here</a>.
          </p>
          <p>
            To protect patron privacy, we won't:
            <ul>
              <li>Include patron names, or details, in emails (we don't even know them!)</li>
              <li>Contact authors several times from the same institution within three months</li>
              <li>Contact authors at the same institution as it's being sent from</li>
            </ul>
          </p>
          <p>
            If you have any questions or concerns about this, you can <a href="joe@openaccessbutton.org">email us</a>.
          </p>
          <p><b>
            If you'd prefer we didn't make work Open Access on your behalf, you can do that below.
          </b></p>
          <p>
          <input id="norequests" type="checkbox" class="setting green">
            Do not generate Open Access Button requests
          </p>

        </div>
        <div class="greenbottom">
          <p><a class="btn btn-demo-green  save view pull" href="menu">Save & Continue</a></p>
          <p><a class="green" href="/feedback#general">Feedback</a> | <a class="green view" href="#faq">FAQ</a> | <a class="green" href="/feedback#bug"> Report Issue</a></p>
        </div>
      </div>
    </div>
  </div>

  <div id="joe" class="section">
    <div class="row">
      <div class="col-md-6 col-md-offset-1 content">
        <p>I am for Joe</p>
      </div>

      <div class="col-md-4 col-md-offset-1 green">
        <div class="greenery">
          <h2>Hi Joe, how're you doing?</h2>
        </div>

        <ul>
          <li>a DOI: <a class="preview pull" href="#">10.1145/2908080.2908114</a></li>
          <li>a title: <a class="preview pull" href="#">Ribulose bisphosphate carboxylase: a two-layered, square-shaped molecule of symmetry 422</a></li>
        </ul>

        <div class="greenbottom">
          <p><a class="green" href="/feedback#general">Feedback</a> | <a class="green view" href="#faq">FAQ</a> | <a class="green" href="/feedback#bug"> Report Issue</a></p>
        </div>
      </div>
    </div>
  </div>

  <div id="login" class="section">
    <div class="row">
      <div class="col-md-6 col-md-offset-1 content">

      </div>

      <div class="col-md-4 col-md-offset-1 green">
        <div class="greenery">
          <h2>Login</h2>


        <p>You need to be <a href="/account?next=/instantill/setup">logged in</a> to set up InstantILL. It only takes a moment.</p>
          <input type="text" name="email" id="youremail" class="form-control green" placeholder="Your email address">
          <br>
          <a id="gologin" href="/account?next=/instantill/setup" class="btn btn-demo-green ">Login</a>
           <p>We use your email to contact you about InstantILL, and ensure only you can access your InstantILL settings.</p>
        </div>


        <div class="greenbottom">
          <p><a class="green" href="/feedback#general">Feedback</a> | <a class="green view" href="#faq">FAQ</a> | <a class="green" href="/feedback#bug"> Report Issue</a></p>
        </div>
      </div>
    </div>
  </div>

  <div id="faq" class="section">
    <div class="row">
      <div class="col-md-6 col-md-offset-1 content">

        <h1 style="text-align:left;margin-top:25px;margin-bottom:25px;font-size:4em;">FAQ</h1>

        <h1>Contents</h1>

            <p>1. How, generally, does InstantILL work?</p>
            <p>2. What systems do you work with?</p>
            <p>3. How do you find my subscriptions?</p>
            <p>4. How do you find Open Access?</p>
            <p>5. How do you find article metadata?</p>
            <p>6. How do you submit ILLs?</p>
            <p>7. How much OA can I expect to find?</p>
            <p>8. How do you decide what links to Open Access / Subscriptions to provide?</p>
            <p>9. Where do I put InstantILL?</p>
            <p>10. How can I be sure InstantILL is sustainable?</p>
            <p>11. Who's using InstantILL?</p>
            <p>12. What's on the roadmap?</p>
            <p>13. Can I alter the text of InstantILL?</p>
            <p>14. Is InstantILL a link resolver?</p>
            <p>15. How do you handle our patrons data?</p>
            <br /><br />
            <h1>1. How, generally, does InstantILL work?</h1>
            <p>A brief overview can be found <a href="https://blog.openaccessbutton.org/instantill-is-being-rolled-out-at-iupui-heres-how-it-works-8103a096df0d">here</a>. A deeper dive can be found <a href="https://scholarworks.iupui.edu/bitstream/handle/1805/20422/07-PAXTON.pdf?sequence=1&amp;isAllowed=y">here</a>.</p>

            <h1>2. What systems do you work with?</h1>
            <p>See the <a href="https://dev.openaccessbutton.org/instantill/setup#compatibility">compatibility list</a>.</p>
            <h1>3. How do you find my subscriptions?</h1>
            <p>Our goal is to find what you have subscribed to and be able to direct users on or off campus to a full-text link.</p>
            <p>We understand your holdings by integrating with your link resolver. If it says you have access, we tell the patron that you do, and we provide them with the link. This means that you handle authentication, you don't have another system to maintain, and only you know what your patron is accessing. To set this up, all we need is your link resolver URL.</p>

            <h1>4. How do you find Open Access?</h1>

            <p>Sometimes, patrons need help finding an accessible copy. If there is an open access copy, we'll use the Open Access Button API to give immediate access and provide clear instructions on how it can and can't be used. We've been pioneers in discovering and delivering open access copies, and our content comes only from legal aggregators such as Unpaywall, DOAJ, and <a href="https://openaccessbutton.org/about#sources">many more</a>.</p>
            <p>Our sources include all of the aggregated repositories in the world, hybrid articles, open access journals, and those on authors' personal pages. We don't use content from ResearchGate or Academia.edu.</p>

            <h1>5. How do you find article metadata?</h1>
            <p>Our goal is to identify, from reliable sources, metadata about articles so we can give ILL teams (and other services) everything they need to know. We do that using a similar approach and <a href="https://openaccessbutton.org/about#sources">sources that we use for finding Open Access</a>, plus Crossref.</p>

            <h1>6. How do you submit ILLs?</h1>

            <p>Our goal is to streamline the submission of your ILL forms without you needing to change systems or do complex integrations.</p>
            <p>InstantILL works with your existing ILL systems to create requests in one of three ways. The primary method is to use a flexible OpenURL (or URL parameters, where article information is communicated through the URL), commonly supported in library systems, to send patrons to your existing ILL form with all the required fields filled out for confirmation. This means your existing ILL system handles login, submission, payment, and fulfillment, and as we never want to handle your patrons' information. If your patrons submit requests via email instead of a form, InstantILL can submit requests to any email address. Lastly, we provide a free, documented API that your technical staff can use to integrate with your ILL system.</p>
            <p>Soon, we hope to do deep integrations over APIs with ILL systems to enable users to submit requests directly through our streamlined UI.</p>

            <h1>7. How much OA can I expect to find?</h1>

            <p>In short, an increasing amount. It depends on what your patrons read, what you subscribe to, and how you configure your systems to access the content. There is no one-size-fits-all answer. We've seen as <a href="https://pdxscholar.library.pdx.edu/cgi/viewcontent.cgi?article=1276&amp;context=ulib_fac">high as 23%</a> and <a href="https://blog.openaccessbutton.org/what-weve-been-doing-to-understand-how-to-put-open-access-into-ill-5d4b9a3e89e3">as low as 5%</a>. We consider 10% to be a reasonable guess, and we <a href="https://openaccessbutton.org/oasheet">built OAsheets so you can get an exact answer</a>. However, what we know is that <a href="https://blog.ourresearch.org/future-oa-key-findings/">more and more articles will be Open Access</a>, so this is increasingly important to take into account.</p>

            <h1>8. How do you decide what links to Open Access / Subscriptions to provide?</h1>
]
            <p>If we find you have subscribed access to something, we'll provide that even if we find an open access version. With both subscribed and open access content, we try to provide links directly to full text (i.e. avoiding splash pages).</p>

            <h1>9. Where do I put InstantILL?</h1>

            <p>Wherever you want your Interlibrary Loan form. Anywhere you can put a couple of lines of code InstantILL can be integrated. This means it can be put:</p>
            <ul>
            <li>On your ILL information pages</li>
            <li>Inside your current ILL system</li>
            <li>Inside your library search</li>
            <li>On a link resolver page</li>
            <li>On an alternative access page</li>
            <li>Into the middle of a workflow (e.g. Link resolver to ILL form)</li>
            </ul>
            <p>And more.</p>

            <h1>10. How can I be sure InstantILL is sustainable?</h1>

            <p>A focus on sustainability is essential for open-source community-owned projects, and it's something that we have given a lot of thought to. While we keep a version of InstantILL free for anyone to use in order to serve our mission, we offer a paid service and strongly recommend that institutions concerned about the sustainability of the tool pay to ensure it is. Details of what you'll get in return can be found at <a href="https://instantill.org/leadership">InstantILL.org/leadership</a>. Even for those who pay, we're committed to creating more cost savings for institutions than we request back in financial support.</p>
            <p>If we're not able to sustain the tool, then our <a href="https://openaccessbutton.org/contingency-and-succession-plan">contingency and succession plan</a> will come into effect.</p>

            <h1>11. Who's using InstantILL?</h1>

            <p>We partnered with IUPUI to be the first to rollout InstantILL. In late 2019, we started a beta where others could implement it. With over 400 institutions on the waiting list for InstantILL, we expect many campuses to be using it soon.</p>
            <p>Soon, we'll have examples for you to see and people you can contact to discuss experiences with InstantILL.</p>

            <h1>12. What's on the roadmap?</h1>

            <p>We're continuing to build out features from your requests and user feedback &mdash; for example, supporting purchase on demand, using InstantILL as a replacement for link resolvers/library search, and enabling InstantILL to help authors make their work open access. You can track what we're planning on <a href="https://github.com/OAButton/discussion/issues?q=is%3Aopen+is%3Aissue+label%3A%221.+InstantILL%22+sort%3Aupdated-desc">Github</a>, where we openly discuss issues and enhancements to make.</p>

            <h1>13. Can I alter the text of InstantILL?</h1>

            <p>The goal of InstantILL's copy is to succinctly and simply explain to an end-user how to use the tool, while ensuring users understand what they're receiving. To this end, we work with experts in website copywriting and librarians, we test directly with users (through user testing), and we review real usage data. This means any sentence you see in InstantILL has likely undergone dozens of revisions and benefits from hours of real work testing. This often results in counter-intuitive results, but ones that work.</p>
            <p>Copy is automatically customized to meet major use cases (e.g placement on front pages, link resolvers, ILL forms, etc.), significant settings changes (e.g enabling forms for books, changing ILL price and delivery times), and regional differences.</p>
            <p>Generally, we don't allow individual libraries to further customize copy for their version given the above process helping ensure high quality and consistent copy for users while ensuring we can build and maintain InstantILL for a broad audience at a low cost without individual libraries needing to manage updates. However, we gratefully accept feedback and suggestions, and where we see strong ideas or frequent issues, we'll ensure they're resolved through the process above.</p>
            <p>If you want deeply customized copy, you're welcome to use our APIs and code to replicate the functionality with your own preferences.</p>

            <h1>14. Is InstantILL a link resolver?</h1>

            <p>InstantILL is a next generation Interlibrary Loan form with a strong focus on excellent user interfaces and experience. It delivers accessible content immediately, while streamlining Interlibrary Loan requesting and management. As we speak with the library community we're hearing that it feels similar to a link resolver, and we're exploring if there is a strong desire to actively cultivate that.</p>
            <p>Currently, we don't consider InstantILL a fully fledged link resolver because it can't directly manage what you do or don't subscribe to. We use your existing Link Resolver for that. However, we can:</p>
            <ul>
            <li>Be integrated into databases via OpenURL</li>
            <li>Streamline access to research articles through subscriptions, Open Access, and interlibrary loan</li>
            <li>Provide a new user interface for your current link resolver</li>
            <li>Be placed between your current link resolver and ILL form to ensure patrons don't submit ILL requests for available content.</li>
            </ul>

            <h1>15. How do you protect our patrons' privacy?</h1>
            
            <p>We value, and are strong advocates for, privacy. We don't want your patrons' data, and so we build products and business models that don't rely on collecting it.</p>
            <p>Whenever possible, we try not to collect data on who's using InstantILL, for example we rely on your authentication systems to log patrons in. The one exception to this is when ILLs are submitted over email, where we ask for a patron's email so the library can contact them.</p>
            <p>Analytics provided through InstantILL only give aggregated figures on how many searches have been done, and what their outcome was.</p>
            <p>You can find more in our <a href="https://openaccessbutton.org/privacy">privacy policy</a>, and <a href="https://openaccessbutton.org/terms">terms of use</a>. If you have concerns, let us know.</p>

      </div>

      <div class="col-md-4 col-md-offset-1 green">
        <div class="greenery">
          <p><a class="green view pull" href="#menu"><span class="glyphicon glyphicon-arrow-left"></span>  Go to Menu</a></p>
          <h2>Not got your quesiton answered?</h2>
          <p>
            Drop <a href="mailto:Joe@openaccessbutton.org" class="green">Joe@openaccessbutton.org</a> an email.
          </p>

          <h2>Think you've found an issue?</h2>
          <p>
            Report it <a href="/feedback#bug" class="green">here</a>.
          </p>

        </div>

        <div class="greenbottom">
          <p><a class="btn btn-demo-green  view" href="#menu">Go to Menu</a></p>
          <p><a class="green" href="/feedback#general">Feedback</a> | <a class="green view" href="#faq">FAQ</a> | <a class="green" href="/feedback#bug"> Report Issue</a></p>
        </div>
      </div>
    </div>
  </div>

  <div id="compatibility" class="section">
    <div class="row">
      <div class="col-md-6 col-md-offset-1 content">

        <h1 style="text-align:left;margin-top:25px;margin-bottom:25px;font-size:3em;">Compatibility</h1>

          <h2>Supported systems</h2>
          <p>
          <b>ILL</b>
            <ul>
              <li>ILLiad</li>
              <li>Relais ILL</li>
              <li>Tipasa</li>
              <li>WMS</li>
              <li>Email</li>
            </ul>
          </p>
          <p>
            <b>Subscriptions</b>
            <ul>
              <li>Serial Solutions</li>
              <li>EBSCO Full Text Finder</li>
              <li>SFX</li>
            </ul>
          </p>

          <h2>Soon to be supported systems</h2>
          <p>
            <li>Primo</li>
            <li>Alma</li>
          </p>

          <h2>I don't see my system...</h2>
          <p>
            That doesn't mean InstantILL won't work for you! InstantILL can submit ILL's to most systems that can fill forms with OpenURL. Even if not all the integrations work, that mean InstantILL can't still provide significant value.
          </p>
          <p>
            If you find your system works, <a href="mailto:joe@openaccessbutton.org">let us know</a>, and we'll add it to supported systems.
          </p>
          <p>
            Our hope is that InstantILL will support all major, or open, library systems.
          </p>

      </div>

      <div class="col-md-4 col-md-offset-1 green">
        <div class="greenery">
          <p><a class="green view pull" href="#menu"><span class="glyphicon glyphicon-arrow-left"></span>  Go to Menu</a></p>
          <h2>Need help?</h2>
          <p>
            Drop <a href="mailto:Joe@openaccessbutton.org" class="green">Joe@openaccessbutton.org</a> an email.
          </p>

        </div>

        <div class="greenbottom">
          <p><a class="btn btn-demo-green  view" href="#menu">Go to Menu</a></p>
          <p><a class="green" href="/feedback#general">Feedback</a> | <a class="green view" href="#faq">FAQ</a> | <a class="green" href="/feedback#bug"> Report Issue</a></p>
        </div>
      </div>
    </div>
  </div>


</div>



<!-- functions you can trigger:

Put a div with ID "instantill" in the place where you want the instantill demo to show up. Note this can only appear in one place at a time.

The page tries to execute a login on page load.
If it succeeds it will try to replace the content of any element on the page with the "stickidin" class with the user ID.
It will also try to replace "but only you" in the content of any element with the "onlyyou" class with "but only you (USERNAME)".
And it will look for any section with the class "stickidin" and will replace any text that contains instantill() with the instantill({SETTINGS})
suitable for the logged in user (their user ID).

It will then go through any ILL config present for the logged in user, and for every value, it will look for an element on the page with the matching ID,
and it will place the value of that config item as the value of the element (note as described below for saving, such elements should also have the "setting" class).
(if it is a boolean value the element should be a checkbox, and it will be checked or not depending on boolean value).

Any button with the "view" class will cause the UI view to change between divs with the "section" class.
The "view" class button goes to the next "section" div by default. If you also give the button the "previous" class it goes to the previous one.
If the "view" button has an href that is longer than 1 then the href value is assumed to be the ID of the div to show, or a classname for a set of things to show.
Any execution of a "view" button first hides all "section" divs then shows the previous or next or defined things.

If you want the section that you switch to with the "view" button to show the #instantill demo in it, you
can add the "pull" class to the button. Then, once the view has switched to the specified section, the #instantill demo div will be appended to the content section of the currently visible section.

Any button ("button" or "a" link tag) that has the "save" class will trigger a save
A save will look for any element with the "setting" class and will take the value of that element and try to use it as the config value corresponding to the ID of that element.
If the save button also has an attr called "preview" then it can be set to true to trigger an instantill preview run with a default value
If preview attr is set but is some value other than true, then the value of the preview attr will be used in the instantill box

Any button with the "preview" class will trigger the instantill box with a trial value. The value should be specified on the button in an attr called "val" or else the html content of the button will be used as the value.

NOTE: if you want the view to change when a preview is triggered, put the view class BEFORE the preview class.
That way the view will change, the preview will run, and if the preview is not visible it will be pulled forward
into the view you have changed to.
-->

<script src="/static/instantill.js"></script>

<script>
jQuery(document).ready(function() {
  $('#topnav').remove();
  $('#footer').remove();
});
</script>

<script src="/static/instantill_ui.js"></script>

<script>
jQuery(document).ready(function() {

  if ($('#demo').height() < $(window).height()) $('#demo').css({'min-height':$(window).height()+'px'});
  $('div.green').css({'min-height':$(window).height()+'px'});
  var diff = Math.floor(($(window).height() - $('div.content:visible').height())/4);
  $('div.content:visible').css({'padding-top':diff+'px'});

  $(document).ajaxComplete(function(e,xhr) {
    if (xhr && xhr.responseJSON && xhr.responseJSON.data && xhr.responseJSON.data.availability !== undefined) {
      _ill_response = xhr.responseJSON.data;
      // an availability check finished, reposition the instantill window if necessary
      /*if (($('#instantill').height() + $('#instantill').offset().top) > ($(window).height()*.95)) {
        var diff = Math.floor(($(window).height() - $('#instantill').height())/2)-20;
        if (diff < 20) diff = 20;
        $('div.content:visible').css({'padding-top':diff+'px'});
      }*/
      $('div.content:visible').css({'padding-top':'100px'});
      $('.oabutton_ill').off();
    }
  });

  var addsubscription = function(e) {
    try {e.preventDefault(); } catch(err) {}
    if ($('.subscription').last().val() && $('.subscription_type').last().val()) {
      $('.subscription').last().clone().val('').insertBefore($('#addsubscription'));
      $('.subscription_type').last().clone().val('').insertBefore($('#addsubscription'));
    } else {
      $('.subscription').last().focus();
    }
  }
  $('body').on('click','#addsubscription',addsubscription);

  var guesssubscription = function(e) {
    if ($(this).val().indexOf('sfx.') !== -1) {
      $(this).next('.subscription_type').val('sfx');
    } else if ($(this).val().indexOf('ebscohost.') !== -1) {
      $(this).next('.subscription_type').val('eds');
    } else if ($(this).val().indexOf('serialssolutions.') !== -1) {
      $(this).next('.subscription_type').val('sfx');
    }
  }
  $('body').on('change','.subscription',guesssubscription);

  var configure = function() {
    for (var k in uc) {
      if (k === 'pilot' || k === 'live') {
        $('#'+k).prop('checked', uc[k]);
      } else if (typeof uc[k] === 'boolean') {
        $('#'+k).prop('checked', uc[k] === true);
      } else if (k === 'subscription') {
        if (typeof uc.subscription === 'string') uc.subscription = uc.subscription.split(',');
        for ( var s in uc.subscription) {
          if (parseInt(s) !== 0) addsubscription();
          if (typeof uc.subscription[s] === 'object') {
            var url = uc.subscription[s].url;
            var type = uc.subscription[s].type;
          } else {
            var url = uc.subscription[s];
            try {
              var type = uc.subscription_type[s];
            } catch(err) {
              var type = 'unknown';
            }
          }
          $('.subscription').last().val(url);
          $('.subscription_type').last().val(type);
        }
      } else if (k !== 'subscription_type') {
        $('#'+k).val(uc[k]);
      }
    }
  }

  var _preview = false;
  var save = function(e,pvw) {
    try { e.preventDefault(); } catch (err) {}
    if (e === true || pvw || $(this).attr('preview') || $(this).hasClass('preview')) _preview = $(this).attr('preview') ? $(this).attr('preview') : (pvw ? pvw : true);
    var data = {};
    $('.setting').each(function(i, obj) {
      if ( $(this).is(':checkbox') ) {
        data[$(this).attr('id')] = $(this).is(':checked');
      } else if ( $(this).hasClass('subscription') ) {
        if ($(this).val()) {
          if (data.subscription === undefined) data.subscription = [];
          data.subscription.push($(this).val())
        } else if ($('.subscription').length > 1) {
          $(this).remove();
        }
      } else if ( $(this).hasClass('subscription_type') ) {
        if ($(this).val()) {
          if (data['subscription_type'] === undefined) data['subscription_type'] = [];
          data['subscription_type'].push($(this).val())
        } else if ($('.subscription_type').length > 1) {
          $(this).remove();
        }
      } else if ( $(this).val() !== undefined ) {
        data[$(this).attr('id')] = $(this).val();
        if (['ill_redirect_base_url','terms','book','other'].indexOf($(this).attr('id')) !== -1 && data[$(this).attr('id')] !== '' && data[$(this).attr('id')].indexOf('http') !== 0) {
          data[$(this).attr('id')] = 'http://' + data[$(this).attr('id')];
          $(this).val(data[$(this).attr('id')]);
        }
      }
    });

    var opts = {
      url: api + '/ill/config',
      type:'POST',
      cache:false,
      processData:false,
      contentType: 'application/json',
      dataType: 'json',
      success: function(data) {
        uc = data; // returns the updated user config
        configure();
        if (_preview) {
          $('.save').hide().after('<p class="saved">Saving changes! Your preview will run shortly.</p>');
          setTimeout(function() { $('.saved').hide(); $('.save').show(); preview(undefined,_preview); }, 3000);
          _preview = false;
        } else {
          $('.save').hide().after('<p class="saved">Saving changes!</p>');
          setTimeout(function() { $('.saved').hide(); $('.save').show(); }, 4000);
        }
      },
      error: function(data) {
        $('#save').hide().after('<p class="saved">Sorry, changes could not be saved.</p>');
        setTimeout(function() { $('.saved').hide(); $('#save').show(); }, 4000);
        _preview = false;
      },
      beforeSend: function (request) { request.setRequestHeader("x-apikey", noddy.apikey); }
    }
    opts.data = JSON.stringify(data);
    if (noddy.apikey) {
      $.ajax(opts);
    } else {
      if (_preview) {
        $('.save').hide().after('<p class="saved">You need to login to save changes! Your preview will run shortly.</p>');
        setTimeout(function() { $('.saved').hide(); $('.save').show(); preview(undefined,_preview); }, 3000);
        _preview = false;
      } else {
        $('.save').hide().after('<p class="saved">You need to login to save changes!</p>');
        setTimeout(function() { $('.saved').hide(); $('.save').show(); }, 4000);
      }
    }
  }
  $('body').on('click','.save',save);

  noddy.afterLogin = function() {
    $('.promptsignup').hide();
    var uid = noddy.user.account._id;
    if ($('.stickidin').length) {
      var uid = noddy.user.account._id;
      var repstr = 'instantill({uid:"' + uid + '"';
      if (api.indexOf('dev.') !== -1) repstr += ',api:"' + api + '"';
      repstr += '})';
      $('.stickidin').html($('.stickidin').html().replace('instantill()',repstr));
    }
    if ($('.onlyyou').length) $('.onlyyou').html($('.onlyyou').html().replace('but only you ','but only you (' + noddy.user.account.profile.firstname + ') '));
    instantill({uid:uid, api:api, css: false});
    try {
      $('.email').attr('placeholder','default ' + (noddy.user.account.email ? noddy.user.account.email : noddy.user.account.emails[0].address));
    } catch(err) {}
    try {
      uc = noddy.user.account.service.openaccessbutton.ill.config;
      configure();
    } catch(err) {}
    try {
      var q = {"size": 0, "query": {"filtered": {"query": {"bool": {"must": [{"term": {"plugin": "instantill"}},{"term": {"from.exact": noddy.user.account._id}}]}}}}};
      q.aggregations = {"embeds": {"terms": {"field": "embedded.exact"}}};
      $.ajax({
        url: api + '/availabilities',
        type: 'POST',
        data: q,
        success: function(iia) {
          try {
            var eurl = false;
            for (var eu in iia.aggregations.embeds.buckets) {
              var eur = iia.aggregations.embeds.buckets[eu].key.split('?')[0].split('#')[0];
              if (eur.indexOf('instantill.org') === -1 && eur.indexOf('openaccessbutton.org') === -1) {
                eurl = eur;
                break;
              }
            }
            if (eurl) {
              var ex = 'You can use this as the Base URL to integrate InstantILL into your other systems:<br>' + eurl + '.<br><br>Here is an example URL:<br>' + eurl + '?doi=10.1145/2908080.2908114 .<br><br>You likely have a more complex looking OpenURL. Not to worry! InstantILL can recognize a wide variety of standard OpenURL parameters so it should still just work.';
              $('#embeddedexample').html(ex).show();
            } else {
              $('#noembeddedexampleavailable').show();
            }
          } catch(err) {
            $('#noembeddedexampleavailable').show();
          }
        }
      });
    } catch(err) {}
    /*if (noddy.hasRole('root')) {
      $('#ill_config').prepend('<input style="border-color:red;" id="uid" type="text" class="form-control setting" placeholder="UID (ADMIN setting override)"><br>')
    }*/
  }

  if ($('#gologin').length) $('#gologin').bind('click',function(e) {
    if ($('#youremail').val()) $(this).attr('href',$(this).attr('href').replace('?','?email='+$('#youremail').val()+'&'));
  });

  noddy.nologin = function() {
    view(undefined,'#login');
  }
  noddy.login();
});
</script>
