<!-- Start of openaccessbutton Zendesk Widget script -->
<script>/*<![CDATA[*/window.zEmbed||function(e,t){var n,o,d,i,s,a=[],r=document.createElement("iframe");window.zEmbed=function(){a.push(arguments)},window.zE=window.zE||window.zEmbed,r.src="javascript:false",r.title="",r.role="presentation",(r.frameElement||r).style.cssText="display: none",d=document.getElementsByTagName("script"),d=d[d.length-1],d.parentNode.insertBefore(r,d),i=r.contentWindow,s=i.document;try{o=s}catch(e){n=document.domain,r.src='javascript:var d=document.open();d.domain="'+n+'";void(0);',o=s}o.open()._l=function(){var e=this.createElement("script");n&&(this.domain=n),e.id="js-iframe-async",e.src="https://assets.zendesk.com/embeddable_framework/main.js",this.t=+new Date,this.zendeskHost="openaccessbutton.zendesk.com",this.zEQueue=a,this.body.appendChild(e)},o.write('<body onload="document._l();">'),o.close()}();
/*]]>*/</script>
<!-- End of openaccessbutton Zendesk Widget script -->

<style>
  #docs h2 {
    margin-top:80px;
  }
  @media handheld, only screen and (max-width: 767px) {
    #docs {
      word-wrap: break-word;
    }
    code {
      white-space: pre-wrap;
    }
  }
</style>

<div class="container-fluid">
  <div class="row">
    <div class="col-md-8 col-md-offset-2">
      <h1 style="text-align:left;margin-top:25px;margin-bottom:25px;font-size:4em;">
        ILL API
      </h1>
    </div>
  </div>
</div>

<div class="container-fluid" id="docs" style="margin-bottom:100px;">
  <div class="row">
    <div class="col-md-8 col-md-offset-2" style="text-align:justify;">
      <p>
        Our ILL API allows you to find out if an article is available via your subscription or freely available anywhere else. 
        If not, it helps collect the metadata necessary for an Inter-Library Loan and can interface with your ILL process to 
        make it more accurate and more efficient.
      </p>
      <p>
        The API uses JSON for all posts and responses.  Links to example responses are shown for each api operation documented below.<!-- - install a JSON viewer plugin to your
        browser to make them easier to read-->. When POSTing data, remember to set the Content-Type header to application/json, e.g.
        for curl this header is added like so: <code>curl -H "Content-Type:application/json"</code>.
      </p>
      <p>
        There are no enforced rate limits, so limit your requests to a maximum of one request per second. If we notice problems we'll suspend your account and contact you about your needs.
        Although most api operations do not require authorisation, we ask that you please obtain and use your own API key.
      </p>
      <p id="apikey">
        Please <a href="/account?next=/api" class="label label-info">sign up / sign in</a> to see your user ID and API key here.
      </p>
      <p>
        Include the API key you are provided in either a URL param called "apikey"
        or in a header called "x-apikey".
        So, a curl call to the availability operation below might look like so (if you choose to use headers):</p>
        <p><code>curl -H "Content-Type: application/json" <br>-H "x-apikey: yourRegisteredApikey" <br>'{{api}}/ill'</code></p>
      </p>

      <h2>
        {{api}}/ill
      </h2>
      <hr>
      <h3>
        GET
        <small style="margin-left:10px;">
          <a class="api" target="_blank" href="{{api}}/ill">
            Example
          </a>
        </small>
      </h3>
      <p>
        This is the root for all ILL API calls and simply returns an indication of api status.
        The API returns a json status success message and 200 response code if the api is operational; otherwise the API is not in operation.
      </p>
      <h3>
        POST
      </h3>
      <b>Authorisation required</b>
      <p>
        A POST to the root will start an ILL request. Parameters can be provided either as URL parameters or as keys in a JSON body, 
        although JSON body is much easier in this case. You must provide a metadata key with as much metadata as possible, or at least 
        as much as your ILL process requires - this can either be retrieved in advance from our /metadata route below so you can review 
        it first, or you can provide at least one of the minimal pieces of information our /metadata route needs to find more information 
        about an article. We will then trigger an ILL via your ILL process, which you must first have configured via the /config route 
        described below. If we have no ILL config for you, we will simply send an email to the email address registered to your Open 
        Access Button account containing the metadata we are either provided or could find for the article. It is also assumed that an 
        ILL should have an email address provided by the person making the ILL request, so you should provide this as the "email" parameter 
        in your URL parameters or JSON body, and it will be included in the information sent on to your ILL process.
      </p>

      <h2>
        /metadata
      </h2>
      <hr>
      <h3>
        GET
        <small style="margin-left:10px;">
          <a class="api" target="_blank" href="{{api}}/ill/metadata?url=http%3A%2F%2Fjournals.plos.org%2Fplosone%2Farticle%3Fid%3Dinfo%253Adoi%2F10.1371%2Fjournal.pone.0163591">
            Example
          </a>
        </small>
      </h3>
      <p>
        Given some article metadata as query parameters, searches for and returns as much metadata as we can find about the time, from as many sources as we can check. 
        At least one of "title", "url", "citation", "doi", "pmid", "pmcid" must be provided for us to be able to do any searching. Proper identifiers are most likely to 
        give good results, followed by full titles, then URLs to web pages containing information about the article, or citation strings.
      </p>
      <p>
        A simple way to make a request to the metadata API is the following one liner where YOURTITLE is your "title" paremeter:
      </p>
      <p>
        <code>curl -H "x-apikey: yourRegisteredApikey" <br>-X GET "{{api}}/ill/metadata?title=YOURTITLE"</code>
      </p>
      <h3>
        POST
      </h3>
      <p>
        As above, but accepts parameters as URL parameters or in a JSON body.
      </p>

      <h2>
        /config
      </h2>
      <hr>
      <h3>
        GET
      </h3>
      <p>Returns your current ILL configuration. You can alter this using a POST to the same route, see below.</p>
      <p>By controlling your ILL configuration you can let us know where to forward ILL requests to, e.g. a web page 
      on your domain that contains the ILL submission form that you expect users to complete. You can also let us know 
      which URL parameters that page accepts so that we can auto-populate the form with as much metadata as we can find. 
      Or, if a link to a form is not appropriate, you can configure an email address that we will send to in order to start 
      an ILL request. You can also set informative URLs for us to show the end user, such as links to your terms and conditions - 
      see the InstantILL management page at <a href="/instantill_alpha">/instantill_alpha</a> for full details of what is configurable.</p>
      <h3>
        POST
      </h3>
      <p><b>Authorisation required</b></p>
      <p>
        Updates your ILL configuration. The values you can provide, either as URL parameters or as keys in a JSON body object, 
        are the same as those that you can edit on the InstantILL management page at <a href="/instantill_alpha">/instantill_alpha</a>
      </p>

<!--
      <h2>
        /ills
      </h2>
      <hr>
      <h3>
        GET or POST
        <small style="margin-left:10px;">
          <a class="api" target="_blank" href="{{api}}/ills">
            Example
          </a>
        </small>
      </h3>
      <p>
        This endpoint allows you to flexibly search and explore all the ILLs we have received.  Valid elasticsearch queries are accepted.
        TODO decide if this is worth sharing or not.
      </p>
-->

<!--
      <h2>
        /ill/:id
      </h2>
      <hr>
      <h3>
        GET
      </h3>
      <p>
        TODO add this API endpoint and return the info of an identified ILL
      </p>
-->


    </div>
  </div>
</div>



<script>
  jQuery(document).ready(function() {
    noddy.afterLogin = function() {
      if (noddy.apikey) {
        $('#apikey').html('Your API key is <code>' + noddy.apikey + '</code>');
        $('.auth').each(function() { $(this).attr('href',$(this).attr('href')+'?apikey='+noddy.apikey); });
      } else {
        $('.auth').hide();
      }
    }
    noddy.login();
  });
</script>
