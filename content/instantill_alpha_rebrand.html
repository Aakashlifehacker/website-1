<!-- JOE: Think about how to lessen the jaring of both sides chaning. Add delay to button press, or add animation. -->

<!-- found at instantill.org/setup -->
<link rel="stylesheet" href="/static/oabutton_rebrand.css"> <!-- gets the new css (still also uses the old css, just overwrites where necessary) -->

<style>
  #topnav {
    display: none;
  }
  #footer {
    display: none;
  }

  .form-control {
    color:#46b633;
    border:2px solid #46b633;
  }

  a {
    color:#46b633;
    font-weight:normal;
  }
  a:hover {
    color:#46b633;
  }

  .btn-hollow {
    border-color: #46b633;
    border-width: 2px;
    border-radius: 0px;
    color: #46b633;
    font-weight: bold;
    padding-top: 10px;
    padding-bottom: 10px;
  }
  .btn-hollow:hover {
    border-color: #46b633;
    border-width: 2px;
    border-radius: 0px;
    color: #46b633;
    font-weight: bold;
    padding-top: 10px;
    padding-bottom: 10px;
  }

</style>

<div id="rebrand" class="container-fluid">

  <div id="menu" class="section">
    <div class="row">
      <div class="col-md-6 col-md-offset-1 content">
        <div id="instantill"></div>
      </div>

      <div class="col-md-4 col-md-offset-1 green">
        <div class="greenery">
          <h2>Welcome, let’s get you set up!</h2>

          <p>
            Congrats, you already have InstantILL partly set up! Already, it can find Open Access articles and submit loans to your email. As you complete the steps below you’ll be able to customize further. It requires no coding or systems expertise, and doesn’t take long.
          </p>
          <p>
            At anytime you can test InstantILL, with your settings, on the left. It’ll work just like it would on your pages, although it won’t be styled with your brand yet.
          </p>
          <p>
            Get InstantILL working with your:
          </p>

          <ul class="arrowed">
            <li>
              <a class="green view pull preview" val="10.1145/2908080.2908114" href="#ill">
                <span class="glyphicon glyphicon-arrow-right">
              </span> Interlibrary loans</a>
            </li>
            <li>
              <a class="green view pull preview" val="10.1145/2908080.2908114" href="#subscription"><span class="glyphicon glyphicon-arrow-right">
              </span> Subscriptions</a>
            </li>
            <li>
              <a class="green view pull preview" val="10.1145/2908080.2908114" href="#embed">
                <span class="glyphicon glyphicon-arrow-right">
              </span> Website &amp; Brand</a>
            </li>
            <li>
              <a class="green view pull preview" val="10.1145/2908080.2908114" href="#workflow">
                <span class="glyphicon glyphicon-arrow-right">
              </span> Workflow</a>
            </li>
          </ul>

            <p>Once you're set up, you might want to look at:</p>

            <ul class="arrowed">

            <li>
              <a class="green view pull preview" val="10.1145/2908080.2908114" href="#analytics">
                <span class="glyphicon glyphicon-arrow-right">
              </span> Analytics</a>
            </li>
            <li>
              <a class="green view pull preview" val="10.1145/2908080.2908114" href="#advanced">
                <span class="glyphicon glyphicon-arrow-right">
              </span> Advanced</a>
            </li>
          </ul>
        </div>

        <div class="greenbottom">
          <p><a class="green light" href="/feedback#general">Feedback</a> | <a class="green light" href="/feedback#bug">Issue</a> | <a class="green light" href="#faq">FAQ</a></p>
        </div>
      </div>
    </div>
  </div>

  <div id="faq" class="section">
    <div class="row">
      <div class="col-md-6 col-md-offset-1 content">

        <h1 style="text-align:left;margin-top:25px;margin-bottom:25px;font-size:4em;">FAQ</h1>

          <p>
            This is a stub for an FAQ. It'll work just like you'd expect when we have questions.
          </p>

      </div>

      <div class="col-md-4 col-md-offset-1 green">
        <div class="greenery">
          <p><a class="green view pull" href="#menu"><span class="glyphicon glyphicon-arrow-left"></span>  Go back</a></p>
          <h2>Not got your quesiton answered?</h2>
          <p>
            Drop <a href="mailto:Joe@openaccessbutton.org">Joe@openaccessbutton.org</a> an email.
          </p>

          <h2>Think you've found an issue?</h2>
          <p>
            Report it <a href="/feedback#bug">here</a>.
          </p>

        </div>

        <div class="greenbottom">
          <p><a class="btn btn-rebrand btn-block" href="#menu">Go to Menu</a></p>
          <p><a class="green light" href="/feedback#general">Feedback</a> | <a class="green light" href="/feedback#bug">Issue</a> | <a class="green light" href="#faq">FAQ</a></p>
        </div>
      </div>
    </div>
  </div>

  <div id="ill" class="section">
    <div class="row">
      <div class="col-md-6 col-md-offset-1 content">

      </div>

      <div class="col-md-4 col-md-offset-1 green">
        <div class="greenery">
          <p><a class="green view pull" href="#menu"><span class="glyphicon glyphicon-arrow-left"></span>  Go to Menu</a></p>
          <h2>Interlibrary loan: Submission</h2>
          <p>
            InstantILL uses your existing Interlibrary Loan systems to manage authentication, fulfillment, and payment, or can submit to an email address.
          </p>

          <p><b>What is your ILL article form link?</b><p>
          <input id="ill_redirect_base_url" type="text" class="form-control setting green" placeholder="URL">
          <p>
          OR
          <p>
          <p><b>What email address do you want ILLs forwarded to? (optional for email alternative)</b></p>
          <input id="email" type="text" class="form-control setting green" placeholder="default is your OAB account email address">
          <br>
          <p>
            If everything works, hit next! If it doesn’t, <a href="#ill-advanced" class="green pull">see advanced settings</a>.
          </p>

        </div>

        <div class="greenbottom">
          <p><a class="btn btn-hollow btn-block save pull preview" href="#">Preview & Test</a></p>
          <p><br><a class="btn btn-rebrand btn-block save view pull" href="#ill-customization"></span> Save and Continue  </a><span class="glyphicon glyphicon-arrow-right"></p>
          <p><a class="green light" href="/feedback#general">Feedback</a> | <a class="green light" href="/feedback#bug">Issue</a> | <a class="green light" href="#faq">FAQ</a></p>
        </div>
      </div>
    </div>
  </div>

  <div id="ill-customization" class="section">
    <div class="row">
      <div class="col-md-6 col-md-offset-1 content">

      </div>

      <div class="col-md-4 col-md-offset-1 green">
        <div class="greenery">
          <p><a class="green view" href="#ill"><span class="glyphicon glyphicon-arrow-left"></span>  Go back</a></p>
          <h2>Interlibrary loan: Settings</h2>
          <p>
            Now that you can submit requests, you can adjust some key details about loans. Everything is optional, and we’ve set common defaults.
          </p>

          <p><b>Name of your institution</b><p>
          <input id="ill_institution" type="text" class="form-control setting green" placeholder="Institution name">
          <br>
          <p><b>What do your article ILLs cost? Please include your currency symbol e.g $4</b><p>
          <input id="cost" type="text" class="form-control setting green" placeholder="default free">
          <!-- TODO: MARK, when hitting save and preview after changing values, like the above, it doesn't update in the preview. -->
          <br>
          <p><b>How long do your ILLs take to deliver on average? e.g 24 hours</b><p>
          <input id="time" type="text" class="form-control setting green" placeholder="default 24 hours">
          <br>
          <p><b>What email address do you want users referred to if there is a problem?</b><p>
          <input id="problem_email" type="text" class="form-control setting green" placeholder="no default, the user will be told to contact their library">
          <br>
          <p><b>Terms and conditions link</b><p>
          <input id="terms" type="text" class="form-control setting green" placeholder="e.g https://libguides.newman.ac.uk/students/inter_library/terms">
          <br>
          <p><b>Where do you want people sent if they want a book?</b><p>
          <input id="book" type="text" class="form-control setting green" placeholder="e.g https://ill.ulib.iupui.edu/ILLiad/IUP/illiad.dll?Action=10&Form=21">
          <br>
          <p><b>Where do you want people sent if they want something other than a book or article</b><p>
          <input id="other" type="text" class="form-control setting green" placeholder="e.g https://ill.ulib.iupui.edu/ILLiad/IUP/illiad.dll?Action=10&Form=10">
          <br>
          <p><b>
            If you use WMS, inside our notifications we can provide direct links to journals to save you time. Just let us know your WMS URL.
          </b>
          <input id="search" type="text" class="form-control setting green" placeholder="e.g  https://ambslibrary.share.worldcat.org/wms/cmnd/nd/discover/items/search"><br>
          </p>
          <p>
            <!-- Would be great if these were green, not blue -->
            <p><b>
              If we find an article Open Access, do you want to let patrons still request an ILL?
            </b></p>
          <input id="noillifoa" type="checkbox" class="setting green">
            No
          </p>
          <p><b>
            If we find that you're subscribed to an article, do you still want patrons to be able to request an ILL?
          </b></p>
          <p>
          <input id="noillifsub" type="checkbox" class="setting green">
            No
          </p>
          <p><b>
            We use article to refer to academic journal publications by default. Would you like to change that?
          </b></p>
          <p>
          <input id="saypaper" type="checkbox" class="setting green">
            Yes, use 'paper' instead.
          </p>
        </div>

        <div class="greenbottom">
          <p><a class="btn btn-hollow btn-block save pull preview" href="#">Preview & Test</a></p>
          <p><br><a class="btn btn-rebrand btn-block save view pull" href="#subscription">Save and Continue</a>  <span class="glyphicon glyphicon-arrow-right"></span> </p>
          <p><a class="green light" href="/feedback#general">Feedback</a> | <a class="green light" href="/feedback#bug">Issue</a> | <a class="green light" href="#faq">FAQ</a></p>
        </div>
      </div>
    </div>
  </div>

  <div id="ill-advanced" class="section">
    <div class="row">
      <div class="col-md-6 col-md-offset-1 content">

      </div>

      <div class="col-md-4 col-md-offset-1 green">
        <div class="greenery">
          <p><a class="green view" href="#ill"><span class="glyphicon glyphicon-arrow-left"></span>  Go back</a></p>
          <h2>Interlibrary loan: Advanced</h2>
          <p>
            InstantILL uses your existing Interlibrary Loan systems to manage authentication, fulfillment, and payment, or can submit to an email address.
          </p>

          Add any additional params your base URL needs, such as a=b&c=d<br>
          <input id="ill_redirect_params" type="text" class="form-control setting green" placeholder="Add any additional params your base URL needs"><br>
          <!--<input id="method" type="text" class="form-control setting" placeholder="default GET"><br>-->
          Add the param used to provide a service ID (which will be InstantILL)<br>
          <input id="sid" type="text" class="form-control setting green" placeholder="default sid">
          <br>
          Title<br>
          <input id="title" type="text" class="form-control setting green" placeholder="default atitle">
          <br>
          Journal title<br>
          <input id="journal" type="text" class="form-control setting green" placeholder="default title">
          <br>
          DOI<br>
          <input id="doi" type="text" class="form-control setting green" placeholder="default rft_id">
          <br>
          Author<br>
          <input id="author" type="text" class="form-control setting green" placeholder="default au">
          <br>
          ISSN<br>
          <input id="issn" type="text" class="form-control setting green" placeholder="default issn">
          <br>
          Volume<br>
          <input id="volume" type="text" class="form-control setting green" placeholder="default volume">
          <br>
          Issue<br>
          <input id="issue" type="text" class="form-control setting green" placeholder="default issue">
          <br>
          Page<br>
          <input id="page" type="text" class="form-control setting green" placeholder="default pages">
          <br>
          Published<br>
          <input id="published" type="text" class="form-control setting green" placeholder="default date">
          <br>
          PMID<br>
          <input id="pmid" type="text" class="form-control setting green" placeholder="default pmid">
          <br>
          <!--<input id="pmcid" type="text" class="form-control setting" placeholder="default pmcid"><br>-->
          Year
          <input id="year" type="text" class="form-control setting green" placeholder="default rft.year">
          <br>



          </p>
        </div>

        <div class="greenbottom">
          <p><a class="btn btn-hollow btn-block save pull preview" href="#">Preview & Test</a></p>
          <p><br><a class="green view next pull" href="#"><span class="glyphicon glyphicon-arrow-right"></span> Next</a></p>
          <p><a class="green light" href="/feedback#general">Feedback</a> | <a class="green light" href="/feedback#bug">Issue</a> | <a class="green light" href="#faq">FAQ</a></p>
        </div>
      </div>
    </div>
  </div>

  <div id="subscription" class="section">
    <div class="row">
      <div class="col-md-6 col-md-offset-1 content">

      </div>

      <div class="col-md-4 col-md-offset-1 green">
        <div class="greenery">
          <p><a class="green view pull" href="#menu"><span class="glyphicon glyphicon-arrow-left"></span>  Go to Menu</a></p>
          <h2>Subscriptions</h2>
          <p>
            We use your link resolver to understand what you do and don’t have access to. Then, we figure out the best link and send your patrons to it through your proxy.
            <p><b>What is you link resolver URL?</b></p>
            <!--  this shouldn't be done before.
            <input id="subscription" type="text" class="form-control setting green" placeholder="e.g http://rx8kl6yf4x.search.serialssolutions.com">
            -->
            <!-- TODO: Mark, Can it mimic the normal formatting of these? Stick missing some spacing. -->
            <input style="margin-bottom:10px;" type="text" class="form-control subscription setting green" placeholder="e.g http://rx8kl6yf4x.search.serialssolutions.com">
            <select class="form-control subscription_type setting green">
              <option value="">select subscription type...</option>
              <option value="sfx">SFX</option>
              <option value="eds">EDS / Ebsco</option>
              <option value="serialssolutions">Serials Solutions</option>
            </select>
            <br>
            <a class="btn btn-primary" id="addsubscription" href="#">Add another</a>

          </p>
        </div>
        <div class="greenbottom">
          <p><a class="btn btn-hollow btn-block save pull preview" href="#">Preview & Test</a></p>
          <p><br><a class="green view next pull" href="#"><span class="glyphicon glyphicon-arrow-right"></span> Next</a></p>
          <p><a class="green light" href="/feedback#general">Feedback</a> | <a class="green light" href="/feedback#bug">Issue</a> | <a class="green light" href="#faq">FAQ</a></p>
        </div>
      </div>
    </div>
  </div>

  <div id="embed" class="section">
    <div class="row">
      <div class="col-md-6 col-md-offset-1 content">

      </div>

      <div class="col-md-4 col-md-offset-1 green">
        <div class="greenery">
          <!-- TODO: Joe, remove the spaces from the underline for these links-->
          <p><a class="green view pull" href="#menu"><span class="glyphicon glyphicon-arrow-left"></span>  Go to Menu</a></p>
          <h2>Website &amp; Brand</h2>

          <p>
            InstantILL can be integrated onto any webpage on your website, and blend in with your brand.
          </p>
          <p>
            To do that you can follow these simple instructions or we’ve drafted an email you can <a href="mailto:" class="light">send your developer</a>.
          </p>

          <p>
            First, include the following in the source code (HTML) of your page:
          </p>
          <pre class="stickidin">
&lt;script src="{{site_url}}/static/instantill.js"&gt;&lt;/script&gt;&lt;script&gt;jQuery(document).ready(function(){instantill();});&lt;/script&gt;
&lt;div id="instantill"&gt;&lt;/div&gt;</pre>

        <p>You can control where the search widget gets displayed by moving:</p>
          <pre>
&lt;div id="instantill"&gt;&lt;/div&gt;</pre>

        <p>
          If you don’t think it’s styled corrected, a developer can help you. If you have one, great, if not <a href="mailto:joe@openaccessbutton.org" class="light">reach out</a>.
        </p>

        <p>You should now be good to go!</p>

        <h3>Some advice</h3>

        <p>We suggest:</p>
        <ul>
          <li>Calling your page ‘Get a paper’</li>
          <li>Not mentioning 'InstantILL' to patrons</li>
        </ul>

        </div>
        <div class="greenbottom">
          <p><br><a class="green view next pull" href="#"><span class="glyphicon glyphicon-arrow-right"></span> Next</a></p>
          <p><a class="green light" href="/feedback#general">Feedback</a> | <a class="green light" href="/feedback#bug">Issue</a> | <a class="green light" href="#faq">FAQ</a></p>
        </div>
      </div>
    </div>
  </div>

  <div id="workflow" class="section">
    <div class="row">
      <div class="col-md-6 col-md-offset-1 content">

      </div>

      <div class="col-md-4 col-md-offset-1 green">
        <div class="greenery">
          <p><a class="green view pull" href="#menu"><span class="glyphicon glyphicon-arrow-left"></span>  Go to Menu</a></p>
          <h2>Workflow</h2>
          <p>
            You can link to InstantILL from any library system to integrate it into your existing workflows, say from library search or a link resolver.
          </p>
          <p id="embeddedexample" style="display:none;"></p>
          <p>
            If everything works, hit next! If it doesn’t, <a href="#workflow-advanced" class="green pull">see advanced settings
          </p>

          <!-- TODO: JOE: Next is in the wrong place, and also, what is embedexample doesn't show anything. hmmmmmmmm. -->
          <!-- TODO: JOE: make nexts save. maybe make it a button. Use 'save and continue' -->
          <!-- TODO: JOE: remove arrows where they're not needed. especially on welcome -->
          <!-- TODO: JOE: maybe add a 'get started button to landing' -->
          <!-- TODO: JOE: clean up bolds, links, go back to designs and see what I fucked up. -->

        </div>
        <div class="greenbottom">
          <p><br><a class="green view pull" href="menu"><span class="glyphicon glyphicon-arrow-right"></span> Next</a></p>
          <p><a class="btn btn-hollow btn-block save pull preview" href="#">Preview & Test</a></p>
          <p><a class="green light" href="/feedback#general">Feedback</a> | <a class="green light" href="/feedback#bug">Issue</a> | <a class="green light" href="#faq">Help</a></p>
        </div>
      </div>
    </div>
  </div>

  <div id="workflow-advanced" class="section">
    <div class="row">
      <div class="col-md-6 col-md-offset-1 content">

      </div>

      <div class="col-md-4 col-md-offset-1 green">
        <div class="greenery">
          <p><a class="green view pull" href="#menu"><span class="glyphicon glyphicon-arrow-left"></span>  Go to Menu</a></p>
          <h2>Workflow, advanced</h2>
          <p>
            It will run automatically on the embedded page if it sees any of the following parameters in the URL: 'doi','title','url','atitle','rft_id','journal','issn','year','author'. You can change these, or turn this off entriely below.
          </p>
          <!-- TODO: Joe, make sure this goes to the right page eventually! -->
          <p><b>
            If you're only linking to InstantILL in the middle of a workflow, you may not want the instructions to show.
          </b></p>
          <small>The instructions are what appear above InstatILLs search box</small>
          <p>
            <input id="intropara" type="checkbox" class="setting">
            Don't show
          </p>
          <!--
          <p><b>Adjust what triggers InstantILL</b></p>
          <p>
            <input id="autorunparams" type="text" class="form-control setting green" placeholder="defaults as above"><br>
          </p>
          <p>
            If InstantILL isn't running when you might expect, that's likely because you're using a paramater we don't recognise.
          </p>
          <p>
            In the box below, you can help us recognise your paramaters.<!-- I really don't understand these instrutions. JOE, discuss with Mark. --><!--Enter any that you want to use, separated by a comma. If you want to use a custom parameter to pass to one of our defaults listed above, provide your parameter name followed by an "=" and the default name you want it to match. For example if you wanted to use our default "doi" and "title" but with your own custom journal parameter, you could specify this as doi,title,mycustomparam=journal.-->
            <!-- Joe, why don't we use a list similar to how we do ILLs here? -->
          <!--
          </p>
          -->
          <p><b>
            You can completely turn off this feature too.
          </b></p>
          <p>
            <input id="autorun" type="checkbox" class="setting">
            Turn off
          </p>

        </div>
        <div class="greenbottom">
          <p><br><a class="green view pull" href="menu"><span class="glyphicon glyphicon-arrow-right"></span> Next</a></p>
          <p><a class="btn btn-hollow btn-block save pull preview" href="#">Preview & Test</a></p>
          <p><a class="green light" href="/feedback#general">Feedback</a> | <a class="green light" href="/feedback#bug">Issue</a> | <a class="green light" href="#faq">FAQ</a></p>
        </div>
      </div>
    </div>
  </div>

  <div id="analytics" class="section">
    <div class="row">
      <div class="col-md-6 col-md-offset-1 content">

      </div>

      <div class="col-md-4 col-md-offset-1 green">
        <div class="greenery">
          <p><a class="green view pull" href="#menu"><span class="glyphicon glyphicon-arrow-left"></span>  Go to Menu</a></p>
          <h2>Analytics</h2>
          <p>

            We can provide individualized analytics detailing your use of InstantILL. However, since this is not essential to delivering an excellent service to end users, we only provide this to users who support our work through our 'Leadership Tier'. To find our more, go <a href="https://openaccessbutton.org/libraries">here</a>.
          </p>
          <p>
            If you're on our leadership teir, and would like a report, email Joe at <a href="joe@openaccessbutton.org">Joe@openaccessbutton.org</a>.
          </p>

        </div>
        <div class="greenbottom">
          <p><a class="green light" href="/feedback#general">Feedback</a> | <a class="green light" href="/feedback#bug">Issue</a> | <a class="green light" href="#faq">FAQ</a></p>
        </div>
      </div>
    </div>
  </div>

  <div id="advanced" class="section">
    <div class="row">
      <div class="col-md-6 col-md-offset-1 content">

      </div>

      <div class="col-md-4 col-md-offset-1 green">
        <div class="greenery">
          <p><a class="green view pull" href="#menu"><span class="glyphicon glyphicon-arrow-left"></span>  Go to Menu</a></p>
          <h2>Advanced</h2>
          <p>
            These aren't needed for normal InstantILL set ups, but you may still be useful.
          </p>

          <h3>API</h3>

          <p>
            You can integrate with InstantILL using APIs. For example, you can reteive all the ILLs made through your embed, or use individual features (e.g OA finding, metadata retreival).
          </p>
          <p>
            Full documentation on how to do this can be found <a href="https://openaccessbutton.org/api" class="green">here</a>.
          </p>

          <h3>Emails to Authors</h3>
          <p>
            To lower the cost of Interlibrary Loan, and make more articles freely available to everyone, when ILLs are submitted through InstantILL we reach out to the authors of those articles to ask them to make them Open Access.
          </p>
          <p>
            We do this on your behalf, as we have done for years for users of the Open Access Button. The current text of emails we send can be found <a href="https://docs.google.com/document/d/1Kh7Smw0nchvFnfhaglNkPc6aJoJV1j0sooKY-enMhhE/edit?usp=sharing" class="green">here</a>.
          </p>
          <p>
            To protect patron privacy, we won't:
            <ul>
              <li>Include patron names, or details, in emails (we don't even know them!)</li>
              <li>Contact authors several times from the same institution within three months</li>
              <li>Contact authors at the same institution as it's being sent from</li>
            </ul>
          </p>
          <p>
            If you have any questions or concerns about this, you can <a href="joe@openaccessbutton.org">email us</a>.
          </p>
          <p><b>
            If you'd prefer we didn't make work Open Access on your behalf, you can do that below.
          </b></p>
          <p>
          <input id="norequests" type="checkbox" class="setting green">
            Do not generate Open Access Button requests
          </p>

        </div>
        <div class="greenbottom">
          <p><a class="btn btn-hollow btn-block save pull preview" href="#">Preview & Test</a></p>
          <p><a class="green light" href="/feedback#general">Feedback</a> | <a class="green light" href="/feedback#bug">Issue</a> | <a class="green light" href="#faq">FAQ</a></p>
        </div>
      </div>
    </div>
  </div>

  <div id="joe" class="section">
    <div class="row">
      <div class="col-md-6 col-md-offset-1 content">
        <p>I am for Joe</p>
      </div>

      <div class="col-md-4 col-md-offset-1 green">
        <div class="greenery">
          <h2>Hi Joe, how're you doing?</h2>
        </div>

        <ul>
          <li>a DOI: <a class="preview pull" href="#">10.1145/2908080.2908114</a></li>
          <li>a title: <a class="preview pull" href="#">Ribulose bisphosphate carboxylase: a two-layered, square-shaped molecule of symmetry 422</a></li>
        </ul>

        <div class="greenbottom">
          <p><a class="green light" href="/feedback#general">Feedback</a> | <a class="green light" href="/feedback#bug">Issue</a> | <a class="green light" href="#faq">FAQ</a></p>
        </div>
      </div>
    </div>
  </div>

  <div id="login" class="section">
    <div class="row">
      <div class="col-md-6 col-md-offset-1 content">

      </div>

      <div class="col-md-4 col-md-offset-1 green">
        <div class="greenery">
          <h2>Login</h2>
        </div>

        <p>Oh dear, you need to be <a href="/account?next=/instantill_alpha_rebrand/">logged in</a> to see this otherwise you won't see your settings, it won't save, and it'll all just get quite confusing. We don't want that.</p>

        <p>
          We'll take you to the OAB site to do this... sit tight.
        </p>

        <div class="greenbottom">
          <p><a class="green light" href="/feedback#general">Feedback</a> | <a class="green light" href="/feedback#bug">Issue</a> | <a class="green light" href="#faq">FAQ</a></p>
        </div>
      </div>
    </div>
  </div>


</div>



<!-- functions you can trigger:

Put a div with ID "instantill" in the place where you want the instantill demo to show up. Note this can only appear in one place at a time.

The page tries to execute a login on page load.
If it succeeds it will try to replace the content of any element on the page with the "stickidin" class with the user ID.
It will also try to replace "but only you" in the content of any element with the "onlyyou" class with "but only you (USERNAME)".
And it will look for any section with the class "stickidin" and will replace any text that contains instantill() with the instantill({SETTINGS})
suitable for the logged in user (their user ID).

It will then go through any ILL config present for the logged in user, and for every value, it will look for an element on the page with the matching ID,
and it will place the value of that config item as the value of the element (note as described below for saving, such elements should also have the "setting" class).
(if it is a boolean value the element should be a checkbox, and it will be checked or not depending on boolean value).

Any button with the "view" class will cause the UI view to change between divs with the "section" class.
The "view" class button goes to the next "section" div by default. If you also give the button the "previous" class it goes to the previous one.
If the "view" button has an href that is longer than 1 then the href value is assumed to be the ID of the div to show, or a classname for a set of things to show.
Any execution of a "view" button first hides all "section" divs then shows the previous or next or defined things.

If you want the section that you switch to with the "view" button to show the #instantill demo in it, you
can add the "pull" class to the button. Then, once the view has switched to the specified section, the #instantill demo div will be appended to the content section of the currently visible section.

Any button ("button" or "a" link tag) that has the "save" class will trigger a save
A save will look for any element with the "setting" class and will take the value of that element and try to use it as the config value corresponding to the ID of that element.
If the save button also has an attr called "preview" then it can be set to true to trigger an instantill preview run with a default value
If preview attr is set but is some value other than true, then the value of the preview attr will be used in the instantill box

Any button with the "preview" class will trigger the instantill box with a trial value. The value should be specified on the button in an attr called "val" or else the html content of the button will be used as the value.

NOTE: if you want the view to change when a preview is triggered, put the view class BEFORE the preview class.
That way the view will change, the preview will run, and if the preview is not visible it will be pulled forward
into the view you have changed to.
-->

<script src="/static/instantill.js"></script>

<script>
jQuery(document).ready(function() {
  $('#topnav').remove();
  $('#footer').remove();
});
</script>

<script src="/static/instantill_ui.js"></script>

<script>
jQuery(document).ready(function() {
  var addsubscription = function(e) {
    try {e.preventDefault(); } catch(err) {}
    if ($('.subscription').last().val() && $('.subscription_type').last().val()) {
      $('.subscription').last().clone().val('').insertBefore($('#addsubscription'));
      $('.subscription_type').last().clone().val('').insertBefore($('#addsubscription'));
    } else {
      $('.subscription').last().focus();
    }
  }
  $('body').on('click','#addsubscription',addsubscription);

  var guesssubscription = function(e) {
    if ($(this).val().indexOf('sfx.') !== -1) {
      $(this).next('.subscription_type').val('sfx');
    } else if ($(this).val().indexOf('ebscohost.') !== -1) {
      $(this).next('.subscription_type').val('eds');
    } else if ($(this).val().indexOf('serialssolutions.') !== -1) {
      $(this).next('.subscription_type').val('sfx');
    }
  }
  $('body').on('change','.subscription',guesssubscription);

  var _preview = false;
  var save = function(e,pvw) {
    try { e.preventDefault(); } catch (err) {}
    if (e === true || pvw || $(this).attr('preview') || $(this).hasClass('preview')) _preview = $(this).attr('preview') ? $(this).attr('preview') : (pvw ? pvw : true);
    var data = {};
    $('.setting').each(function(i, obj) {
      if ( $(this).is(':checkbox') ) {
        data[$(this).attr('id')] = $(this).is(':checked');
      } else if ( $(this).hasClass('subscription') ) {
        if ($(this).val()) {
          if (data.subscription === undefined) data.subscription = [];
          data.subscription.push($(this).val())
        } else {
          $(this).remove();
        }
      } else if ( $(this).hasClass('subscription_type') ) {
        if ($(this).val()) {
          if (data['subscription_type'] === undefined) data['subscription_type'] = [];
          data['subscription_type'].push($(this).val())
        } else {
          $(this).remove();
        }
      } else if ( $(this).val() !== undefined ) {
        data[$(this).attr('id')] = $(this).val();
        if (['ill_redirect_base_url','terms','book','other'].indexOf($(this).attr('id')) !== -1 && data[$(this).attr('id')] !== '' && data[$(this).attr('id')].indexOf('http') !== 0) {
          data[$(this).attr('id')] = 'http://' + data[$(this).attr('id')];
          $(this).val(data[$(this).attr('id')]);
        }
      }
    });

    var opts = {
      url: api + '/ill/config',
      type:'POST',
      cache:false,
      processData:false,
      contentType: 'application/json',
      dataType: 'json',
      success: function(data) {
        if (_preview) {
          $('.save').hide().after('<p class="saved">Changes saved! Your preview will run shortly.</p>');
          setTimeout(function() { $('.saved').hide(); $('.save').show(); preview(undefined,_preview); }, 3000);
          _preview = false;
        } else {
          $('.save').hide().after('<p class="saved">Changes saved!</p>');
          setTimeout(function() { $('.saved').hide(); $('.save').show(); }, 4000);
        }
      },
      error: function(data) {
        $('#save').hide().after('<p class="saved">Sorry, changes could not be saved.</p>');
        setTimeout(function() { $('.saved').hide(); $('#save').show(); }, 4000);
        _preview = false;
      },
      beforeSend: function (request) { request.setRequestHeader("x-apikey", noddy.apikey); }
    }
    opts.data = JSON.stringify(data);
    if (noddy.apikey) {
      $.ajax(opts);
    } else {
      if (_preview) {
        $('.save').hide().after('<p class="saved">You need to login to save changes! Your preview will run shortly.</p>');
        setTimeout(function() { $('.saved').hide(); $('.save').show(); preview(undefined,_preview); }, 3000);
        _preview = false;
      } else {
        $('.save').hide().after('<p class="saved">You need to login to save changes!</p>');
        setTimeout(function() { $('.saved').hide(); $('.save').show(); }, 4000);
      }
    }
  }
  $('body').on('click','.save',save);

  noddy.afterLogin = function() {
    $('.promptsignup').hide();
    var uid = noddy.user.account._id;
    if ($('.stickidin').length) {
      var uid = noddy.user.account._id;
      var repstr = 'instantill({uid:"' + uid + '"';
      if (api.indexOf('dev.') !== -1) repstr += ',api:"' + api + '"';
      repstr += '})';
      $('.stickidin').html($('.stickidin').html().replace('instantill()',repstr));
    }
    if ($('.onlyyou').length) $('.onlyyou').html($('.onlyyou').html().replace('but only you ','but only you (' + noddy.user.account.profile.firstname + ') '));
    instantill({uid:uid, api:api, css: false});
    try {
      $('.email').attr('placeholder','default ' + (noddy.user.account.email ? noddy.user.account.email : noddy.user.account.emails[0].address));
    } catch(err) {}
    try {
      var uc = noddy.user.account.service.openaccessbutton.ill.config;
      for (var k in uc) {
        if (typeof uc[k] === 'boolean') {
          if (uc[k] === true) $('#'+k).prop('checked',true);
        } else if (k === 'subscription') {
          if (typeof uc.subscription === 'string') uc.subscription = uc.subscription.split(',');
          for ( var s in uc.subscription) {
            if (parseInt(s) !== 0) addsubscription();
            if (typeof uc.subscription[s] === 'object') {
              var url = uc.subscription[s].url;
              var type = uc.subscription[s].type;
            } else {
              var url = uc.subscription[s];
              try {
                var type = uc.subscription_type[s];
              } catch(err) {
                var type = 'unknown';
              }
            }
            $('.subscription').last().val(url);
            $('.subscription_type').last().val(type);
          }
        } else if (k !== 'subscription_type') {
          $('#'+k).val(uc[k]);
        }
      }
    } catch(err) {}
    try {
      var q = {"size": 0, "query": {"filtered": {"query": {"bool": {"must": [{"term": {"plugin": "instantill"}},{"term": {"from.exact": noddy.user.account._id}}]}}}}};
      q.aggregations = {"embeds": {"terms": {"field": "embedded.exact"}}};
      $.ajax({
        url: api + '/availabilities',
        type: 'POST',
        data: q,
        success: function(iia) {
          try {
            var eurl = iia.aggregations.embeds.buckets[0].key.split('?')[0].split('#')[0];
            var ex = 'For example:<br>';
            ex += eurl + '?doi=10.1145/2908080.2908114';
            $('#embeddedexample').html(ex).show();
          } catch(err) {}
        }
      });
    } catch(err) {}
    /*if (noddy.hasRole('root')) {
      $('#ill_config').prepend('<input style="border-color:red;" id="uid" type="text" class="form-control setting" placeholder="UID (ADMIN setting override)"><br>')
    }*/
  }
  noddy.nologin = function() {
    view(undefined,'#login');
  }
  noddy.login();
});
</script>
