<!-- Start of openaccessbutton Zendesk Widget script -->
<script>/*<![CDATA[*/window.zEmbed||function(e,t){var n,o,d,i,s,a=[],r=document.createElement("iframe");window.zEmbed=function(){a.push(arguments)},window.zE=window.zE||window.zEmbed,r.src="javascript:false",r.title="",r.role="presentation",(r.frameElement||r).style.cssText="display: none",d=document.getElementsByTagName("script"),d=d[d.length-1],d.parentNode.insertBefore(r,d),i=r.contentWindow,s=i.document;try{o=s}catch(e){n=document.domain,r.src='javascript:var d=document.open();d.domain="'+n+'";void(0);',o=s}o.open()._l=function(){var e=this.createElement("script");n&&(this.domain=n),e.id="js-iframe-async",e.src="https://assets.zendesk.com/embeddable_framework/main.js",this.t=+new Date,this.zendeskHost="openaccessbutton.zendesk.com",this.zEQueue=a,this.body.appendChild(e)},o.write('<body onload="document._l();">'),o.close()}();
/*]]>*/</script>
<!-- End of openaccessbutton Zendesk Widget script -->

<style>
  textarea {
    min-height:200px;
  }
</style>

<div class="container-fluid goto gotochoose">
  <div class="row">
    <div class="col-md-8 col-md-offset-2">
      <h1 style="text-align:left;margin-top:25px;margin-bottom:25px;font-size:4em;">
        Feedback
      </h1>
      <p>
        What do you want to tell us about?
      </p>
      <select class="form-control" id="goto">
        <option value="">Please choose an option:</option>
        <option value="general">General feedback and ideas</option>
        <option value="wrong">We found the wrong content</option>
        <option value="bug">I found a bug</option>
        <!-- add any needed types of form here so they can be selected -->
      </select>
    </div>
  </div>
</div>


<div class="container-fluid">
  <div class="row">
    <div class="col-md-8 col-md-offset-2">
      <form id="form" method="POST" action="https://api.openaccessbutton.org/bug" style="display:none;">

        <!-- particular forms can be directly reached for example by appending #dnr to the page URL -->
        <!-- extra parameters for the bug message can be added as URL params too -->

        <div class="goto gotobug">
					<h4 style="text-align:left;margin-top:25px;margin-bottom:25px;font-size:4em;">Report a bug</h4>
          <p>We'll get it fixed as soon as we can, and let you know.</p>
					<h3 class="hideifknown">Your email address</h3>
					<p><input type="text" name="email" class="form-control" placeholder="Your email"></p>
					<h3>Where are you having the issue?</h3>
          <p><input type="checkbox" name="where" value="Chrome plugin"> Chrome plugin</p>
          <p><input type="checkbox" name="where" value="Firefox plugin"> Firefox plugin</p>
          <p><input type="checkbox" name="where" value="Website"> Website</p>
          <p><input type="checkbox" name="where" value="Bookmarklet"> Bookmarklet</p>
					<h3>What's the issue?</h3>
					<p><textarea name="issue" class="form-control" style="min-height:200px;" placeholder="It's helpful if you can tell us what happened, what you expect to happen, and how we can reproduce the issue."></textarea></p>
					<h3>Do you have an error code? If so, please tell us it</h3>
					<p><input type="text" name="code" class="form-control" placeholder="Error code"></p>
					<h3>Anything else we should know?</h3>
					<p><textarea name="info" class="form-control" style="min-height:200px;" placeholder="Tell us anything you think might help us solve the issue."></textarea></p>
        </div>

        <div class="goto gotodnr">
          <h4 style="text-align:left;margin-top:25px;margin-bottom:25px;font-size:4em;">Sorry you don’t want to hear from us</h4>
          <p>We’d love to know why you’d prefer to not hear from us:</p>
          <p><input type="checkbox" name="why" value="Don't understand what I'm being asked"> I don't understand what I'm being asked</p>
          <p><input type="checkbox" name="why" value="Don't know or trust oab"> I don’t know or trust the Open Access Button</p>
          <p><input type="checkbox" name="why" value="Don't want to share data / articles"> I don’t want to share my data or article</p>
          <p><input class="form-control" type="text" name="other" placeholder="Other (please state)"></p>
          <p>Our team is still learning. Can we follow up with you about your experience?</p>
          <p><input type="radio" name="followup" value="yes"> Yes</p>
          <p><input type="radio" name="followup" value="no"> No</p>
        </div>

        <div class="goto gotowrong">
          <!-- the link to this bug form could include a URL param "request", with the ID of the request the user is saying is wrong -->
          <h4 style="text-align:left;margin-top:25px;margin-bottom:25px;font-size:4em;">Wrong content? Let's get that fixed</h4>
          <p>We apologize that we didn’t give you the content you were looking for. Linking to the correct version can be difficult sometimes. Please let us know your issue and we’ll work to resolve it:</p>
          <h3>What did you search for?</h3>
					<p><input type="text" name="searched" class="form-control" placeholder="Put what you searched for here"></p>
          <h3>What did we find?</h3>
					<p><input type="text" name="given" class="form-control" placeholder="Put the URL we sent you to here"></p>
          <h3>What was wrong?</h3>
          <p><input type="checkbox" name="wrong" value="Wrong paper searched for"> The Button searched for the wrong paper</p>
          <p><input type="checkbox" name="wrong" value="Known open copy not given"> A copy I know is availiable wasn't shown</p>
          <p><input type="checkbox" name="wrong" value="Paper not actually available"> The article wasn't actually available</p>
          <p><input type="checkbox" name="wrong" value="Not full text"> I didn't get sent directly to the full-text</p>
          <h3>Can you tell us the correct URL to the content?</h3>
          <p><input class="form-control" type="text" name="correction" placeholder="(optional) Correct URL, if known"></p>
        </div>

        <div class="goto gotouninstall">
          <!-- for this form, set the URL in google chrome extension uninstall link: -->
          <!-- https://developer.chrome.com/extensions/runtime#method-setUninstallURL -->
          <!-- link should be https://openaccessbutton.org/bug#uninstall -->
          <h4 style="text-align:left;margin-top:25px;margin-bottom:25px;font-size:4em;">We're sad to see you go</h4>
          <p>We're constantly trying to improve the Button, can you help by giving us some quick feedback?</p> 
          <h3>Why are you uninstalling the Open Access Button? Check all that apply:</h3>
          <p><input type="checkbox" name="why" value="It never found what I needed"> It never found what I needed</p>
          <p><input type="checkbox" name="why" value="It's hard to use"> It's hard to use</p>
          <p><input type="checkbox" name="why" value="I don't want to make requests"> I don't want to make requests</p>
          <p><input type="checkbox" name="why" value="It didn't work"> It didn't work</p>
          <h3>Please let us know any other feedback you have:</h3>
          <p><textarea class="form-control" name="feedback" placeholder="How can we improve?"></textarea></p>
          <h3 class="hideifknown">What's your email address?</h3>
          <p><input type="text" name="email" class="form-control" placeholder="Your email"></p>
        </div>

        <div class="goto gotonoshare">
          <!-- the link to the page for this form could include the request ID -->
          <h4>Why can't you share this research?</h4>
          <p><input type="checkbox" name="why" value="I don't have the time"> I don't have the time</p>
          <p><input type="checkbox" name="why" value="I don't have the expertise"> I don't have the expertise</p>
          <p><input type="checkbox" name="why" value="There are privacy issues"> There are privacy issues</p>
          <p><input type="checkbox" name="why" value="It's not my data"> It's not my data</p>
          <p><input type="checkbox" name="why" value="I don't have the files needed anymore"> I don't have the files needed anymore</p>
          <p><input type="checkbox" name="why" value="I need to publish more from the data"> I need to publish more from the data</p>
          <p><input class="form-control" type="text" name="other" placeholder="Other (please explain)"></p>
        </div>

        <div class="goto gotogeneral">
          <!-- the link to the page for this form could include a param of the previous page -->
          <h4 style="text-align:left;margin-top:25px;margin-bottom:25px;font-size:4em;">Let us know what you think!</h4>
          <p>We spend day (and night) making the Open Access Button the best it can be. If you have any feedback or ideas we'd love to hear them.</p>
          <p><textarea class="form-control" name="feedback" placeholder="Tell us what you think."></textarea></p>
          <h3 class="hideifknown">What's your email address?</h3>
          <p><input class="form-control" type="text" name="email" placeholder="email address"></p>
        </div>

        <!-- put any additional form types here -->

        <noscript>
          <input type="hidden" name="nojs" value="nojs">
        </noscript>
        <input id="submit" name="submit" value="Submit" type="submit" class="btn btn-action btn-block">
      </form>
    </div>
  </div>
</div>


<div class="container-fluid">
  <div class="row">
    <div class="col-md-8 col-md-offset-2">
      <div class="goto gotodefaultthanks">
        <h3 style="text-align:left;margin-top:25px;margin-bottom:25px;font-size:4em;">Thanks</h3>
        <p>Thanks for your response.</p>
      </div>

      <!-- custom thanks areas can be added here -->
    </div>
  </div>
</div>


<script>
  jQuery(document).ready(function() {
    var api = 'https://api.openaccessbutton.org';
    if (window.location.host.indexOf('openaccessbutton.org') === -1 || window.location.host.indexOf('dev.openaccessbutton.org') !== -1) {
      api = 'https://dev.api.cottagelabs.com/service/oab';
    }

		if (window.location.href.indexOf('?') !== -1) {
			var pt = window.location.href.split('?')[1];
			var pts = pt.split('&');
			for ( var pt in pts ) {
				var prts = pts[pt].split('=');
				if (prts.length === 2 && prts[0].length && prts[1].length && $('[name="' + prts[0] + '"]').length) $('[name="' + prts[0] + '"]').val(decodeURIComponent(prts[1]));
			}
		}


    if (clogin.loggedin()) {
      $('.hideifknown').hide();
      $('[name="email"]').val(clogin.getCookie().email).hide();
    }

    $('#form').attr('action',api+'/bug');
    $('.goto').hide();
    var goto = window.location.hash.split('?')[0].replace('#','');
    if (!goto) {
      goto = 'choose';
    } else {
      $('#form').show();
    }
    if (goto.indexOf('thanks') !== -1) {
      $('#form').hide();
      if (!$('.goto'+goto).length) goto = 'defaultthanks';
    }
    $('.goto'+goto).show();

    var choose = function(e) {
      if (e) e.preventDefault();
      $('.goto').hide();
      goto = $(this).val();
			if ('pushState' in window.history) window.history.pushState("", "feedback", '#' + goto);
			$('#form').show();
      $('.goto'+goto).show();
    }
    $('#goto').bind('change',choose);

    var submit = function(e) {
      if (e) e.preventDefault();

      var data = {form:goto};

      $('input,select,textarea').each(function() {
        if ( $(this).parents('.goto'+goto) ) {
          var key = $(this).attr('name') ? $(this).attr('name') : $(this).attr('id');
          var val = $(this).val() ? $(this).val() : $(this).attr('value');
          if ( ( $(this).attr('type') === 'checkbox' || $(this).attr('type') === 'radio' ) && !$(this).is(':checked') ) val = undefined;
          if ( key === "submit" ) key = undefined;
          if ( key && val ) {
            if (data[key] === undefined) {
              data[key] = val;
            } else {
              if (typeof data[key] !== 'object') data[key] = [data[key]];
              data[key].push(val);
            }
          }
        }
      });

      if (window.location.href.indexOf('?') !== -1) {
        var p = window.location.href.split('?')[1];
        var pairs = p.split('&');
        for ( var pr in pairs ) {
          var parts = pairs[pr].split('=');
          if (parts.length === 2 && parts[0].length && parts[1].length) data[parts[0]] = decodeURIComponent(parts[1]);
        }
      }

      data.page = window.location.href;
      data.language = navigator.language || navigator.userLanguage
			data.viewport = {
				width: window.innerWidth,
				height: window.innerHeight
			}
      try {
        data.user = clogin.user;
        data.cookie = clogin.getCookie();
      } catch(err) {}
      try {
        data.navigator = {
          userAgent: navigator.userAgent,
          platform: navigator.platform,
          vendor: navigator.vendor,
          plugins: navigator.plugins
        }
      } catch(err) {}

      // submit the form with ajax, or just stick stringified data into a form field and submit the form normal?
      $.ajax({
        type:'POST',
        url: api + '/bug',
        cache:false,
        processData:false,
        contentType: 'application/json',
        dataType: 'json',
        data:JSON.stringify(data)
      });

      goto += 'thanks';
      $('.goto').hide();
      $('#form').hide();
      if (!$('.goto'+goto).length ) goto = 'defaultthanks';
      $('.goto'+goto).show();
    }
    $('#submit').bind('click',submit);
  });

</script>
